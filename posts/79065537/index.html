<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Language" content="zh-cn">
    <meta charset="utf-8">
    
    
    <link rel="canonical" href="https://leng521.top/posts/79065537/">
    
    
    <title>scons自动构建工具 | 小魏的博客 | 摔倒了爬起来就好。</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    
    <meta name="theme-color" content="#77AAFF">
    
    
    <meta name="keywords" content="python,c++,scons">
    
    

    

    <!-- Baidu Push -->
<script>
	(function(){
		var bp = document.createElement('script');
		var curProtocol = window.location.protocol.split(':')[0];
		if (curProtocol === 'https') {
			bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
		}
		else {
			bp.src = 'http://push.zhanzhang.baidu.com/push.js';
		}
		var s = document.getElementsByTagName("script")[0];
		s.parentNode.insertBefore(bp, s);
	})();

	var _hmt = _hmt || [];
</script>


	<script src="//hm.baidu.com/hm.js?2eaff0c5326867354b0d3469d507d209"></script>


    
    <meta name="description" content="这篇文章可能有点长,如果你想要学到一些知识,而不是简单入门,你要有耐心的看下去,当然在看的时候,也要自己思考,也许我写的有问题,这个时候你可以再去看看,官方文档.这个教程由于内容太多,有些还没来得及写.一般我这里不会太多的去,介绍它的历史,和它是干啥的,你可以自己去找度娘去了解.我这里只有逻辑和事例代码. 工具版本: 3.0.1scons user guide scons user guide s">
<meta name="keywords" content="python,c++,scons">
<meta property="og:type" content="article">
<meta property="og:title" content="scons自动构建工具">
<meta property="og:url" content="https://leng521.top/posts/79065537/index.html">
<meta property="og:site_name" content="小魏的博客">
<meta property="og:description" content="这篇文章可能有点长,如果你想要学到一些知识,而不是简单入门,你要有耐心的看下去,当然在看的时候,也要自己思考,也许我写的有问题,这个时候你可以再去看看,官方文档.这个教程由于内容太多,有些还没来得及写.一般我这里不会太多的去,介绍它的历史,和它是干啥的,你可以自己去找度娘去了解.我这里只有逻辑和事例代码. 工具版本: 3.0.1scons user guide scons user guide s">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2018-12-25T13:46:14.655Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="scons自动构建工具">
<meta name="twitter:description" content="这篇文章可能有点长,如果你想要学到一些知识,而不是简单入门,你要有耐心的看下去,当然在看的时候,也要自己思考,也许我写的有问题,这个时候你可以再去看看,官方文档.这个教程由于内容太多,有些还没来得及写.一般我这里不会太多的去,介绍它的历史,和它是干啥的,你可以自己去找度娘去了解.我这里只有逻辑和事例代码. 工具版本: 3.0.1scons user guide scons user guide s">
    
        <link rel="alternate" type="application/atom+xml" title="小魏的博客" href="/atom.xml">
    
    <link rel="shortcut icon" href="/img/favicon.png">
    <link id="style" rel="stylesheet" href="/css/style.css?v=3.0">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    
            
</head>

<body>
    <div id="loading" class="active"></div>
    <aside id="menu"  class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" >
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/head.jpg" alt="avatar">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname" id="name">小魏</h5>
          
            <div id="mymotto" class="motto"></div>
          
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
              <li class="waves-block waves-effect">
                  <a href="/"  >
                    <i class="icon icon-lg icon-home"></i>
                    <span>主 页</span><i class="icon icon-lg icon-caret-left"></i>
                  </a>
              </li>
            
              <li class="waves-block waves-effect">
                  <a href="/archives"  >
                    <i class="icon icon-lg icon-archives"></i>
                    <span>归 档</span><i class="icon icon-lg icon-caret-left"></i>
                  </a>
              </li>
            
              <li class="waves-block waves-effect">
                  <a href="/categories"  >
                    <i class="icon icon-lg icon-th-list"></i>
                    <span>分 类</span><i class="icon icon-lg icon-caret-left"></i>
                  </a>
              </li>
            
              <li class="waves-block waves-effect">
                  <a href="/tags"  >
                    <i class="icon icon-lg icon-tags"></i>
                    <span>标 签</span><i class="icon icon-lg icon-caret-left"></i>
                  </a>
              </li>
            
              <li class="waves-block waves-effect">
                  <a href="/about"  >
                    <i class="icon icon-lg icon-smile-o"></i>
                    <span>关 于</span><i class="icon icon-lg icon-caret-left"></i>
                  </a>
              </li>
            
      <div class="nav2">
          
              <a class="nav2item" data-title="Email" href="xiaowei:2807582398@qq.com" target="_parent"title="Email" >
                <i class="icon icon-lg icon-envelope-o envelope-o"></i>
              </a>
          
              <a class="nav2item" data-title="Github" href="https://github.com/" target="_blank"title="Github" >
                <i class="icon icon-lg icon-github github"></i>
              </a>
          

            </div>
        
      </ul>
        
    </div>
  </div>
 
</aside>


    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">scons自动构建工具</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        <a href="../../atom.xml" target="_blank" class="header-icon waves-effect waves-circle waves-light" id="Rss">
            <i class="icon icon-lg icon-rss"></i>
        </a>
    </div>
</header>
<header class="content-header post-header">
    
    
    <div class="container fade-scale">
        <div id="myheader">
            <h1 class="title">
                
            </h1>
            <h5 class="subtitle">
                
                
            </h5>
        </div>
    </div>

</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#scons-普通简单的构建"><span class="post-toc-number">1.</span> <span class="post-toc-text">scons 普通简单的构建</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#多个文件构建"><span class="post-toc-number">2.</span> <span class="post-toc-text">多个文件构建</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Object-构建方法"><span class="post-toc-number">3.</span> <span class="post-toc-text">Object 构建方法</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#清楚构建对中产生的对象"><span class="post-toc-number">4.</span> <span class="post-toc-text">清楚构建对中产生的对象</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#让scons-简介输出"><span class="post-toc-number">5.</span> <span class="post-toc-text">让scons 简介输出</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#设置可执行文件的名字"><span class="post-toc-number">6.</span> <span class="post-toc-text">设置可执行文件的名字</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#构建多个可执行程序"><span class="post-toc-number">7.</span> <span class="post-toc-text">构建多个可执行程序</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#多个可执行程序-使用共同的源文件"><span class="post-toc-number">8.</span> <span class="post-toc-text">多个可执行程序 使用共同的源文件</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#构建-Library-库-从源文件中"><span class="post-toc-number">9.</span> <span class="post-toc-text">构建 Library(库)从源文件中</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#链接库"><span class="post-toc-number">10.</span> <span class="post-toc-text">链接库</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#构造其方法返回节点列表"><span class="post-toc-number">11.</span> <span class="post-toc-text">构造其方法返回节点列表</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#清晰区分-目录节点-和-文件节点"><span class="post-toc-number">12.</span> <span class="post-toc-text">清晰区分 目录节点 和 文件节点</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#从一个节点或字符串获取路径"><span class="post-toc-number">13.</span> <span class="post-toc-text">从一个节点或字符串获取路径</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#重复构建-scons-可以识别出来-会出现-scons-’-is-up-to-date"><span class="post-toc-number">14.</span> <span class="post-toc-text">重复构建 scons 可以识别出来 会出现 scons: `.’ is up to date.</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#自定义-Decider-‘MD5’"><span class="post-toc-number">15.</span> <span class="post-toc-text">自定义 Decider(‘MD5’)</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#编写自定义Decider函数"><span class="post-toc-number">16.</span> <span class="post-toc-text">编写自定义Decider函数</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#隐式构造变量"><span class="post-toc-number">16.1.</span> <span class="post-toc-text">隐式构造变量</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#缓存隐式依赖关系"><span class="post-toc-number">17.</span> <span class="post-toc-text">缓存隐式依赖关系</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#显示依赖关系"><span class="post-toc-number">18.</span> <span class="post-toc-text">显示依赖关系</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#外部文件的依赖关系：ParseDepends-功能"><span class="post-toc-number">19.</span> <span class="post-toc-text">外部文件的依赖关系：ParseDepends 功能</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#忽略依赖项"><span class="post-toc-number">20.</span> <span class="post-toc-text">忽略依赖项</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#AlwaysBuild"><span class="post-toc-number">21.</span> <span class="post-toc-text">AlwaysBuild</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#构造环境feature的使用"><span class="post-toc-number">22.</span> <span class="post-toc-text">构造环境feature的使用</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#环境变量影响-scons-构建"><span class="post-toc-number">23.</span> <span class="post-toc-text">环境变量影响 scons 构建</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#使用外部工具"><span class="post-toc-number">24.</span> <span class="post-toc-text">使用外部工具</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#在构建程序的时候-帮助信息"><span class="post-toc-number">25.</span> <span class="post-toc-text">在构建程序的时候 帮助信息</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#从命令行控制构建流程"><span class="post-toc-number">26.</span> <span class="post-toc-text">从命令行控制构建流程</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#InstallBuilder-安装构建的可执行程序"><span class="post-toc-number">27.</span> <span class="post-toc-text">InstallBuilder 安装构建的可执行程序</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#与平台无关的文件操作"><span class="post-toc-number">28.</span> <span class="post-toc-text">与平台无关的文件操作</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#控制构建目标的移除"><span class="post-toc-number">29.</span> <span class="post-toc-text">控制构建目标的移除</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#分级构建"><span class="post-toc-number">30.</span> <span class="post-toc-text">分级构建</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#分离构建-目标-和-源文件"><span class="post-toc-number">31.</span> <span class="post-toc-text">分离构建 目标 和 源文件</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#变体构建"><span class="post-toc-number">32.</span> <span class="post-toc-text">变体构建</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#国际化"><span class="post-toc-number">33.</span> <span class="post-toc-text">国际化</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#编写自己的-builder-构造器"><span class="post-toc-number">34.</span> <span class="post-toc-text">编写自己的 builder(构造器)</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#缓存构建的文件"><span class="post-toc-number">35.</span> <span class="post-toc-text">缓存构建的文件</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#验证-python-scons-版本"><span class="post-toc-number">36.</span> <span class="post-toc-text">验证 python scons 版本</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#别名目标"><span class="post-toc-number">37.</span> <span class="post-toc-text">别名目标</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#多平台配置（Autoconf功能"><span class="post-toc-number">38.</span> <span class="post-toc-text">多平台配置（Autoconf功能</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#从代码存储库构建"><span class="post-toc-number">39.</span> <span class="post-toc-text">从代码存储库构建</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#编写扫描仪"><span class="post-toc-number">40.</span> <span class="post-toc-text">编写扫描仪</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Not-Writing-a-Builder-the-Command-Builder"><span class="post-toc-number">41.</span> <span class="post-toc-text">Not Writing a Builder: the Command Builder</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Pseudo-Builders-the-AddMethod-function-伪造构建起-添加方法"><span class="post-toc-number">42.</span> <span class="post-toc-text">Pseudo-Builders: the AddMethod function(伪造构建起, 添加方法)</span></a></li></ol>
        </nav>
    </aside>
   
<article id="post-scons自动构建工具"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">scons自动构建工具</h1>
        <div class="post-meta">
            <i class="icon icon-lg icon-calendar-o"></i>
            发表于
            <time class="post-time" title="2018-12-23 23:00:52" datetime="2018-12-23T15:00:52.000Z"  itemprop="datePublished">2018-12-23</time>

            <br id="mybreak"/>
            
	<i class="icon icon-lg icon-folder-o"></i>
	分类：<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/自动构建工具/">自动构建工具</a></li></ul>


            <i>·</i>
            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>次浏览
</span>


        </div>
        <div class="post-count-custom">
            <i class="icon icon-lg icon-comment-o"></i>
            阅读本文可能花费您&nbsp;<span class="post-count">38</span>&nbsp;分钟
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>这篇文章可能有点长,如果你想要学到一些知识,而不是简单入门,你要有耐心的看下去,当然在看的时候,也要自己思考,也许我写的有问题,这个时候你可以再去看看,官方文档.<br>这个教程由于内容太多,有些还没来得及写.<br>一般我这里不会太多的去,介绍它的历史,和它是干啥的,你可以自己去找度娘去了解.我这里只有逻辑和事例代码.</p>
<p>工具版本: 3.0.1<br><a href="https://scons.org/doc/production/HTML/scons-user/">scons user guide</a></p>
<p><a href="https://scons.org/doc/production/HTML/scons-user/">scons user guide</a></p>
<h3 id="scons-普通简单的构建"><a href="#scons-普通简单的构建" class="headerlink" title="scons 普通简单的构建"></a>scons 普通简单的构建</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// file name main.cpp</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span>  <span class="built_in">std</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt; <span class="string">"helloworld"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line">Program(<span class="string">'main.cpp'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="多个文件构建"><a href="#多个文件构建" class="headerlink" title="多个文件构建"></a>多个文件构建</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># 构建多个文件</span></span><br><span class="line">Program([<span class="string">'main.cpp'</span>,<span class="string">'other.cpp'</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 匹配 的方式选择构建的的文件</span></span><br><span class="line"><span class="comment"># 可以使用 Glob()</span></span><br><span class="line"></span><br><span class="line">Program(Glob(<span class="string">'*.cpp'</span>))</span><br><span class="line"></span><br><span class="line">Glob() =&gt; 匹配的方式有个</span><br><span class="line">- * 通配符</span><br><span class="line">- ? 匹配任意一个字符</span><br><span class="line">- [abc] 匹配任意一个符</span><br><span class="line">- [!abc] 输了abc 之外的字符</span><br><span class="line"></span><br><span class="line">Split函数 scons为了方便可以使用 分割函数一空格分割同样做到 多文件编译</span><br><span class="line"></span><br><span class="line">Program(<span class="string">"HelloWorld"</span>,Split(<span class="string">"main.c other.c"</span>))</span><br><span class="line">Program(<span class="string">"HelloWorld"</span>,Split(<span class="string">"""</span></span><br><span class="line"><span class="string">    main.c</span></span><br><span class="line"><span class="string">    other.c"""</span>))</span><br><span class="line">允许使用 多行字符串</span><br><span class="line"></span><br><span class="line">scons 也可以使用指定参数的形式调用</span><br><span class="line"></span><br><span class="line">src_files = Split(<span class="string">'main.c file1.c file2.c'</span>)</span><br><span class="line">Program(target = <span class="string">'program'</span>, source = src_files)</span><br><span class="line"></span><br><span class="line">当然也可以反转参数</span><br><span class="line">src_files = Split(<span class="string">'main.c file1.c file2.c'</span>)</span><br><span class="line">Program(source = src_files, target = <span class="string">'program'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Object-构建方法"><a href="#Object-构建方法" class="headerlink" title="Object 构建方法"></a>Object 构建方法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Object(<span class="string">'main.c'</span>)</span><br><span class="line"></span><br><span class="line">在 POSIX 系统上产生 *.o 文件</span><br><span class="line">在 windows 系统上产生 *.obj 文件</span><br></pre></td></tr></table></figure>
<h3 id="清楚构建对中产生的对象"><a href="#清楚构建对中产生的对象" class="headerlink" title="清楚构建对中产生的对象"></a>清楚构建对中产生的对象</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scons -c</span><br></pre></td></tr></table></figure>
<h3 id="让scons-简介输出"><a href="#让scons-简介输出" class="headerlink" title="让scons 简介输出"></a>让scons 简介输出</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scons -Q</span><br></pre></td></tr></table></figure>
<h3 id="设置可执行文件的名字"><a href="#设置可执行文件的名字" class="headerlink" title="设置可执行文件的名字"></a>设置可执行文件的名字</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Program(<span class="string">"HelloWorld"</span>,<span class="string">"main.cpp"</span>)</span><br><span class="line">在构建目录下产生 名字叫 HelloWorld.exe 的可执行文件</span><br><span class="line">在 POSIX 系统上产生 HelloWorld 的可执行文件</span><br><span class="line"></span><br><span class="line">如果不在 第一个参数 指定 可执行文件的名字 那么将会使用 第一个文件的名字 为可执行程序的名字</span><br></pre></td></tr></table></figure>
<h3 id="构建多个可执行程序"><a href="#构建多个可执行程序" class="headerlink" title="构建多个可执行程序"></a>构建多个可执行程序</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Program(<span class="string">'H1'</span>,[<span class="string">'main.c'</span>])</span><br><span class="line">Program(<span class="string">'H2'</span>,[<span class="string">'main1.c'</span>])</span><br><span class="line"></span><br><span class="line">只需要调用多遍 Program 这个构造器就行了</span><br></pre></td></tr></table></figure>
<h3 id="多个可执行程序-使用共同的源文件"><a href="#多个可执行程序-使用共同的源文件" class="headerlink" title="多个可执行程序 使用共同的源文件"></a>多个可执行程序 使用共同的源文件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">common = [<span class="string">"common1.c"</span>, <span class="string">"common2.c"</span>]</span><br><span class="line">program1 = [<span class="string">"pro1.c"</span>] + common</span><br><span class="line">program2 = [<span class="string">"pro2.c"</span>] + common</span><br><span class="line"></span><br><span class="line">Program(<span class="string">"pro1"</span>,program1)</span><br><span class="line">Program(<span class="string">"pro2"</span>,program2))</span><br></pre></td></tr></table></figure>
<h3 id="构建-Library-库-从源文件中"><a href="#构建-Library-库-从源文件中" class="headerlink" title="构建 Library(库)从源文件中"></a>构建 Library(库)从源文件中</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Library(<span class="string">'haha'</span>,[<span class="string">'main.c'</span>])</span><br><span class="line"></span><br><span class="line">你可以混合构建最终的库 scons 可以识别出来那些需要编译 </span><br><span class="line">这个只会编译 main.c</span><br><span class="line">Library(<span class="string">'haha'</span>,[<span class="string">'main.c'</span>,<span class="string">'common.o'</span>])</span><br><span class="line"></span><br><span class="line">构建静态库</span><br><span class="line">StaticLibrary()</span><br><span class="line">构建动态库</span><br><span class="line">SharedLibrary()</span><br></pre></td></tr></table></figure>
<h3 id="链接库"><a href="#链接库" class="headerlink" title="链接库"></a>链接库</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">LIBS =&gt; 指定要链接的库的名字</span><br><span class="line">LIBPATH =&gt; 要连接库名字的路径</span><br><span class="line"></span><br><span class="line">Library(<span class="string">'foo'</span>, [<span class="string">'f1.c'</span>, <span class="string">'f2.c'</span>, <span class="string">'f3.c'</span>])</span><br><span class="line">Program(<span class="string">'prog.c'</span>, LIBS=[<span class="string">'foo'</span>, <span class="string">'bar'</span>], LIBPATH=<span class="string">'.'</span>)</span><br><span class="line">这里可以简写 如果是一个 直接写库名字 不需要写成使用 列表 包一层</span><br><span class="line"></span><br><span class="line">Library(<span class="string">'foo'</span>, [<span class="string">'f1.c'</span>, <span class="string">'f2.c'</span>, <span class="string">'f3.c'</span>])</span><br><span class="line">Program(<span class="string">'prog.c'</span>, LIBS=<span class="string">'foo'</span>, LIBPATH=<span class="string">'.'</span>)</span><br><span class="line"></span><br><span class="line">多个库路径可以使用 如下格式</span><br><span class="line">[<span class="string">'/home/libs'</span>,<span class="string">'/home/gg/libs'</span>]</span><br><span class="line"><span class="string">'/home/libs:/home/gg/libs'</span>(POSIX系统上的冒号：)</span><br><span class="line"><span class="string">'C:\\libs;C:\\gg\\libs'</span>(Windows系统上的分号;)</span><br></pre></td></tr></table></figure>
<h3 id="构造其方法返回节点列表"><a href="#构造其方法返回节点列表" class="headerlink" title="构造其方法返回节点列表"></a>构造其方法返回节点列表</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">这么做的目的是让我们写的 构建文件是平台的</span><br><span class="line">不同平台 编译后的文件后缀不一样(a.obj(Windows), a.o(Lunix)) 所以 scons 帮我们处理了</span><br><span class="line">返回节点列表 soncs 去处理这些差异</span><br><span class="line">hello_list = Object(<span class="string">'hello.c'</span>, CCFLAGS=<span class="string">'-DHELLO'</span>)</span><br><span class="line">goodbye_list = Object(<span class="string">'goodbye.c'</span>, CCFLAGS=<span class="string">'-DGOODBYE'</span>)</span><br><span class="line"></span><br><span class="line">Program(hello_list + goodbye_list)</span><br><span class="line"></span><br><span class="line">打印节点列表</span><br><span class="line">print(hello_list[<span class="number">0</span>]) // hello.obj(Windows)</span><br><span class="line"></span><br><span class="line">判断文件是否存在</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(program_name):</span><br><span class="line">    print(<span class="string">'不存在'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="清晰区分-目录节点-和-文件节点"><a href="#清晰区分-目录节点-和-文件节点" class="headerlink" title="清晰区分 目录节点 和 文件节点"></a>清晰区分 目录节点 和 文件节点</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">hello_c = File(<span class="string">'hello.c'</span>)</span><br><span class="line">Program(hello_c)</span><br><span class="line"></span><br><span class="line">目录节点</span><br><span class="line">Dir()</span><br><span class="line"></span><br><span class="line">不知道是 目录还是文件</span><br><span class="line">Entry()</span><br></pre></td></tr></table></figure>
<h3 id="从一个节点或字符串获取路径"><a href="#从一个节点或字符串获取路径" class="headerlink" title="从一个节点或字符串获取路径"></a>从一个节点或字符串获取路径</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">env=Environment(VAR=<span class="string">"value"</span>)</span><br><span class="line">n=File(<span class="string">"foo.c"</span>)</span><br><span class="line">print(env.GetBuildPath([n, <span class="string">"sub/dir/$VAR"</span>]))</span><br></pre></td></tr></table></figure>
<h3 id="重复构建-scons-可以识别出来-会出现-scons-’-is-up-to-date"><a href="#重复构建-scons-可以识别出来-会出现-scons-’-is-up-to-date" class="headerlink" title="重复构建 scons 可以识别出来 会出现 scons: `.’ is up to date."></a>重复构建 scons 可以识别出来 会出现 scons: `.’ is up to date.</h3><blockquote>
<p>指出已经是最新的了</p>
</blockquote>
<h3 id="自定义-Decider-‘MD5’"><a href="#自定义-Decider-‘MD5’" class="headerlink" title="自定义 Decider(‘MD5’)"></a>自定义 Decider(‘MD5’)</h3><blockquote>
<p>自定义 重构规则 Decider(‘MD5’) 默认是使用 md5 记录一个文件是够需要从新构建甚至 可以使用 ‘content’ 代表同名词 md5 的缺陷是 如果修改了注释 scons 也认为 没有修改<br>Decider(‘make’) 只要文件的修改时间改变就从新构建 同义词 ‘timestamp-newer’(判定规则是 比上次构建的时间戳新 就从新构建 但是有的使用会碰到 文件还原 这样就会出现 之前构建的时候 比 现在的 新 下面的 记录规则 可以解决这个问题)<br>‘timestamp-match’ 匹配时间戳是否与构建的时候一样,<br>‘MD5-timestamp’ 判定规则是  MD5 和 时间错都改变的时候 在重新构建 (如果在SCons构建文件的最后一秒内修改了源文件 这种情况可能不合适, 但是基本可能不存在)</p>
</blockquote>
<h3 id="编写自定义Decider函数"><a href="#编写自定义Decider函数" class="headerlink" title="编写自定义Decider函数"></a>编写自定义Decider函数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">Program(<span class="string">'hello.c'</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decide_if_changed</span><span class="params">(dependency, target, prev_ni)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> self.get_timestamp() != prev_ni.timestamp:</span><br><span class="line">        dep = str(dependency)</span><br><span class="line">        tgt = str(target)</span><br><span class="line">        <span class="keyword">if</span> specific_part_of_file_has_changed(dep, tgt):</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">Decider(decide_if_changed)</span><br><span class="line"></span><br><span class="line">展开第三个参数</span><br><span class="line">params :</span><br><span class="line">    prev_ni :</span><br><span class="line">        .csig The content signature, <span class="keyword">or</span> MD5 checksum, of the contents of the dependency file the list time the target was built.</span><br><span class="line">        .size The size <span class="keyword">in</span> bytes of the dependency file the list time the target was built.</span><br><span class="line">        .timestamp The modification time of the dependency file the list time the target was built.</span><br><span class="line"></span><br><span class="line">当第一次构建的时候 这个参数 prev_ni 不存在</span><br><span class="line"></span><br><span class="line">读这些东西的时候需要静心观看 不然就可能看不懂呦</span><br><span class="line"></span><br><span class="line">env = Environment()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">config_file_decider</span><span class="params">(dependency, target, prev_ni)</span>:</span></span><br><span class="line">    <span class="keyword">import</span> os.path</span><br><span class="line"></span><br><span class="line">    <span class="comment"># We always have to init the .csig value...</span></span><br><span class="line">    <span class="comment"># 获取依赖文件的签名信息</span></span><br><span class="line">    dep_csig = dependency.get_csig()</span><br><span class="line">    <span class="comment"># .csig may not exist, because no target was built yet...</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">'csig'</span> <span class="keyword">not</span> <span class="keyword">in</span> dir(prev_ni):</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line">    <span class="comment"># Target file may not exist yet</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(str(target.abspath)):</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line">    <span class="keyword">if</span> dep_csig != prev_ni.csig:</span><br><span class="line">        <span class="comment"># Some change on source file =&gt; update installed one</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">update_file</span><span class="params">()</span>:</span></span><br><span class="line">    f = open(<span class="string">"test.txt"</span>,<span class="string">"a"</span>)</span><br><span class="line">    f.write(<span class="string">"some line\n"</span>)</span><br><span class="line">    f.close()</span><br><span class="line"></span><br><span class="line">update_file()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Activate our own decider function</span></span><br><span class="line">env.Decider(config_file_decider)</span><br><span class="line"></span><br><span class="line">env.Install(<span class="string">"install"</span>,<span class="string">"test.txt"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">不同的环境使用不同 判定规则</span><br><span class="line"></span><br><span class="line">env1 = Environment(CPPPATH = [<span class="string">'.'</span>])</span><br><span class="line">env2 = env1.Clone()</span><br><span class="line">env2.Decider(<span class="string">'timestamp-match'</span>)</span><br><span class="line">env1.Program(<span class="string">'prog-MD5'</span>, <span class="string">'program1.c'</span>)</span><br><span class="line">env2.Program(<span class="string">'prog-timestamp'</span>, <span class="string">'program2.c'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="隐式构造变量"><a href="#隐式构造变量" class="headerlink" title="隐式构造变量"></a>隐式构造变量</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* main.c */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;hello.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Hello, %s!\n"</span>, <span class="built_in">string</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* hello.h */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> string    <span class="meta-string">"world"</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Sconsturct</span></span><br><span class="line">Program(<span class="string">'hello.c'</span>, CPPPATH = <span class="string">'.'</span>)</span><br><span class="line">也可以是多个 路径 也可以像 LIBPATH 那样</span><br><span class="line">Program(<span class="string">'hello.c'</span>, CPPPATH = [<span class="string">'include'</span>, <span class="string">'/home/project/inc'</span>])</span><br><span class="line">Window 分割符是 分号 (;) Linux 分隔符是 冒号(:)</span><br><span class="line">Program(<span class="string">'hello.c'</span>, CPPPATH = <span class="string">'include:/home/project/inc'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="缓存隐式依赖关系"><a href="#缓存隐式依赖关系" class="headerlink" title="缓存隐式依赖关系"></a>缓存隐式依赖关系</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SetOption（<span class="string">'implicit_cache'</span>，<span class="number">1</span>）</span><br></pre></td></tr></table></figure>
<p>或则是使用命令行 </p>
<blockquote>
<p>scons -Q –implicit-cache</p>
<p>scons -Q –implicit-deps-changed 通知 scons 跟新隐式缓存 依赖的文件改变时</p>
<p>scons -Q –implicit-deps-unchanged 强制及时依赖的文件改变时 仍然使用 缓存依赖</p>
</blockquote>
<h3 id="显示依赖关系"><a href="#显示依赖关系" class="headerlink" title="显示依赖关系"></a>显示依赖关系</h3><p>有的时候 scons 没有扫描(detected)到依赖关系的时候 scons 允许你 显示指定 依赖关系</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">hello = Program(<span class="string">'hello.c'</span>)</span><br><span class="line">Depends(hello, <span class="string">'other_file'</span>)</span><br><span class="line"></span><br><span class="line">Depends 的第二个参数 也可以是节点 列表</span><br><span class="line"></span><br><span class="line">hello = Program(<span class="string">'hello.c'</span>)</span><br><span class="line">goodbye = Program(<span class="string">'goodbye.c'</span>)</span><br><span class="line">Depends(hello, goodbye)</span><br></pre></td></tr></table></figure>
<h3 id="外部文件的依赖关系：ParseDepends-功能"><a href="#外部文件的依赖关系：ParseDepends-功能" class="headerlink" title="外部文件的依赖关系：ParseDepends 功能"></a>外部文件的依赖关系：ParseDepends 功能</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FOO_HEADER <span class="meta-string">&lt;foo.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> FOO_HEADER</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> FOO;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面这种情况 scons 可能无法 知道依赖关系</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">obj = Object(<span class="string">'hello.c'</span>, CCFLAGS=<span class="string">'-MD -MF hello.d'</span>, CPPPATH=<span class="string">'.'</span>)</span><br><span class="line">SideEffect(<span class="string">'hello.d'</span>, obj)</span><br><span class="line">ParseDepends(<span class="string">'hello.d'</span>)</span><br><span class="line"> Program(<span class="string">'hello'</span>, obj)</span><br></pre></td></tr></table></figure>
<p>借助编译器 对宏的展开 并生成一个 <em>.d 的文件 第一次 scons 无法检测依赖 第二次 scons 可以根据生成的 </em>.d的文件确定依赖关系</p>
<h3 id="忽略依赖项"><a href="#忽略依赖项" class="headerlink" title="忽略依赖项"></a>忽略依赖项</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">hello_obj=Object(<span class="string">'hello.c'</span>)</span><br><span class="line">hello = Program(hello_obj)</span><br><span class="line">Ignore(hello_obj, <span class="string">'hello.h'</span>)</span><br><span class="line"></span><br><span class="line">上面的例子可能很难想象 它依赖的头文件 改变了 不从新编译</span><br><span class="line">有一种情况 比如多个系统 使用同一个 头文件 每个系统的头文件 会有略微的差异</span><br><span class="line">此时依赖的头文件改变了 但是不需要重新编译</span><br><span class="line">hello = Program(<span class="string">'hello.c'</span>, CPPPATH=[<span class="string">'/usr/include'</span>])</span><br><span class="line">Ignore(hello, <span class="string">'/usr/include/stdio.h'</span>)</span><br><span class="line"></span><br><span class="line">hello_obj=Object(<span class="string">'hello.c'</span>)</span><br><span class="line">hello = Program(hello_obj)</span><br><span class="line">Ignore(<span class="string">'.'</span>,[hello,hello_obj])</span><br></pre></td></tr></table></figure>
<h3 id="AlwaysBuild"><a href="#AlwaysBuild" class="headerlink" title="AlwaysBuild"></a>AlwaysBuild</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hello = Program(<span class="string">'hello.c'</span>)</span><br><span class="line">AlwaysBuild(hello)</span><br></pre></td></tr></table></figure>
<h3 id="构造环境feature的使用"><a href="#构造环境feature的使用" class="headerlink" title="构造环境feature的使用"></a>构造环境feature的使用</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">创建新的 构造环境</span><br><span class="line">env = Environment()</span><br><span class="line"></span><br><span class="line">一个简单的例子 设置 c编译器</span><br><span class="line"> env = Environment(CC = <span class="string">'gcc'</span>, CCFLAGS = <span class="string">'-O2'</span>)</span><br><span class="line"> env.Program(<span class="string">'foo.c'</span>)</span><br><span class="line"></span><br><span class="line">访问构造环境的各个变量  (它是个具有关联方法的对象)</span><br><span class="line">env = Environment()</span><br><span class="line">print(<span class="string">"CC is: %s"</span>%env[<span class="string">'CC'</span>])</span><br><span class="line"></span><br><span class="line">如果你仅仅是访问他的构造变量,你可以这样做 调用构造环境的 Dictionary 方法</span><br><span class="line">env = Environment(FOO = <span class="string">'foo'</span>, BAR = <span class="string">'bar'</span>)</span><br><span class="line">dict = env.Dictionary()</span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> [<span class="string">'OBJSUFFIX'</span>, <span class="string">'LIBSUFFIX'</span>, <span class="string">'PROGSUFFIX'</span>]:</span><br><span class="line">    print(<span class="string">"key = %s, value = %s"</span> % (key, dict[key]))</span><br><span class="line"></span><br><span class="line">on Windows &gt; OBJSUFFIX =&gt; .obj LIBSUFFIX =&gt; .lib PROGSUFFIX =&gt; .exe</span><br><span class="line">on Linux &gt; OBJSUFFIX =&gt; .o LIBSUFFIX =&gt; .a PROGSUFFIX =&gt; </span><br><span class="line"></span><br><span class="line">获取构造环境中的变量 方法<span class="number">2</span></span><br><span class="line">使用 subst() 方法 使用 $ + 变量字段 的方式访问</span><br><span class="line">使用这个方法的好处是 它可以将构造变量展开</span><br><span class="line">env = Environment()</span><br><span class="line">print(<span class="string">"CC is: %s"</span>%env.subst(<span class="string">'$CC'</span>))</span><br><span class="line"><span class="comment"># $CCCOM</span></span><br><span class="line"></span><br><span class="line">处理 变量 展开带来的问题</span><br><span class="line">如果访问一个不存在的变量是 scons 并不会报错 </span><br><span class="line">如果想要报错你可以这样做</span><br><span class="line">AllowSubstExceptions() 开始 使用 subst 函数异常的功能 这是个全局变量</span><br><span class="line"></span><br><span class="line">除了定义默认的异常外 还可以定义 其他异常如 零除异常</span><br><span class="line">AllowSubstExceptions(IndexError, NameError, ZeroDivisionError)</span><br><span class="line">env = Environment()</span><br><span class="line">print(<span class="string">"value is: %s"</span>%env.subst( <span class="string">'-&gt;$&#123;1 / 0&#125;&lt;-'</span> ))</span><br><span class="line"></span><br><span class="line">创建默认的 构造环境 可以设置 目标编译器</span><br><span class="line">DefaultEnvironment(CC = <span class="string">'/usr/local/bin/gcc'</span>)</span><br><span class="line"></span><br><span class="line">当然也可以这样做</span><br><span class="line">env = DefaultEnvironment()</span><br><span class="line">env[<span class="string">'CC'</span>] = <span class="string">'/usr/local/bin/gcc'</span></span><br><span class="line"></span><br><span class="line">使用 DefaultEnvironment() 可以加快你初始化构造变量</span><br><span class="line">在初始化时 scons 会在 系统的环境变量中搜索 可用的 编译器 连接器等 你可以指定 搜索的 工具 加快scons的初始化速度 你可以这样做</span><br><span class="line"></span><br><span class="line">直接指定 编译工具 链接工具 指定 c编译器 为gcc</span><br><span class="line">env = DefaultEnvironment(tools = [<span class="string">'gcc'</span>, <span class="string">'gnulink'</span>],</span><br><span class="line">                         CC = <span class="string">'/usr/local/bin/gcc'</span>)</span><br><span class="line"></span><br><span class="line">多构造环境 你可以这样做 不同的构造环境 使用不同的配置</span><br><span class="line">opt = Environment(CCFLAGS = <span class="string">'-O2'</span>)</span><br><span class="line">dbg = Environment(CCFLAGS = <span class="string">'-g'</span>)</span><br><span class="line"></span><br><span class="line">opt.Program(<span class="string">'foo'</span>, <span class="string">'foo.c'</span>)</span><br><span class="line">dbg.Program(<span class="string">'foo'</span>, <span class="string">'foo.c'</span>)</span><br><span class="line">--------------------------------------</span><br><span class="line">产生编译产物 *.obj(on Windows)</span><br><span class="line">opt = Environment(CCFLAGS = <span class="string">'-O2'</span>)</span><br><span class="line">dbg = Environment(CCFLAGS = <span class="string">'-g'</span>)</span><br><span class="line"></span><br><span class="line">o = opt.Object(<span class="string">'foo-opt'</span>, <span class="string">'foo.c'</span>)</span><br><span class="line">opt.Program(o)</span><br><span class="line"></span><br><span class="line">d = dbg.Object(<span class="string">'foo-dbg'</span>, <span class="string">'foo.c'</span>)</span><br><span class="line">dbg.Program(d)</span><br><span class="line"></span><br><span class="line">克隆当前的环境变量</span><br><span class="line">克隆一份一模一样的构造环境</span><br><span class="line">env = Environment(CC = <span class="string">'gcc'</span>)</span><br><span class="line">opt = env.Clone(CCFLAGS = <span class="string">'-O2'</span>)</span><br><span class="line">dbg = env.Clone(CCFLAGS = <span class="string">'-g'</span>)</span><br><span class="line">env.Program(<span class="string">'foo'</span>, <span class="string">'foo.c'</span>)</span><br><span class="line">o = opt.Object(<span class="string">'foo-opt'</span>, <span class="string">'foo.c'</span>)</span><br><span class="line">opt.Program(o)</span><br><span class="line">d = dbg.Object(<span class="string">'foo-dbg'</span>, <span class="string">'foo.c'</span>)</span><br><span class="line">dbg.Program(d)</span><br><span class="line"></span><br><span class="line">替换构造环境</span><br><span class="line">env = Environment(CCFLAGS = <span class="string">'-DDEFINE1'</span>)</span><br><span class="line">env.Replace(CCFLAGS = <span class="string">'-DDEFINE2'</span>)</span><br><span class="line">env.Program(<span class="string">'foo.c'</span>)</span><br><span class="line"></span><br><span class="line">仅在尚未定义的情况下设置值</span><br><span class="line">env.SetDefault(SPECIAL_FLAG = <span class="string">'-extra-option'</span>)</span><br><span class="line"></span><br><span class="line">附加到构造变量末尾</span><br><span class="line">env = Environment(CCFLAGS = [<span class="string">'-DMY_VALUE'</span>])</span><br><span class="line">env.Append(CCFLAGS = [<span class="string">'-DLAST'</span>])</span><br><span class="line">env.Program(<span class="string">'foo.c'</span>)</span><br><span class="line"></span><br><span class="line">附加唯一值</span><br><span class="line">Some times it<span class="string">'s useful to add a new value only if the existing construction variable doesn'</span>t already contain the value. This can be done using the AppendUnique method:</span><br><span class="line">官方解释: 有时 它是有用的 在这个构造变量没有包含这个变量的时候添加一个新值 , 这样可以使使用这个 方法做</span><br><span class="line">env.AppendUnique(CCFLAGS=[<span class="string">'-g'</span>])</span><br><span class="line"></span><br><span class="line">In the above example, the -g would be added only <span class="keyword">if</span> the $CCFLAGS variable does <span class="keyword">not</span> already contain a -g value.</span><br><span class="line">解释: 在上面这个例子, -g 标识将被添加 仅仅这个 $CCFLAGS 变量曾没有包含这个 -g 的标识</span><br><span class="line"></span><br><span class="line">附加到值的开头</span><br><span class="line">env = Environment(CCFLAGS = [<span class="string">'-DMY_VALUE'</span>])</span><br><span class="line">env.Prepend(CCFLAGS = [<span class="string">'-DFIRST'</span>])</span><br><span class="line">env.Program(<span class="string">'foo.c'</span>)</span><br><span class="line"></span><br><span class="line">附加唯一值到开头 和上面在结尾附加值 的 逻辑是一样的</span><br><span class="line">env.PrependUnique（CCFLAGS = [ <span class="string">' -  G'</span>]）</span><br></pre></td></tr></table></figure>
<h3 id="环境变量影响-scons-构建"><a href="#环境变量影响-scons-构建" class="headerlink" title="环境变量影响 scons 构建"></a>环境变量影响 scons 构建</h3><p>it uses the dictionary stored in the $ENV construction variable as the external environment for executing commands.<br>解释: 它使用成字典的方式存储在 ENV 的构造变量中 作为外部可执行命令的环境</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">添加 Path 环境变量到 ENV中执行</span><br><span class="line">path = [<span class="string">'/usr/local/bin'</span>, <span class="string">'/bin'</span>, <span class="string">'/usr/bin'</span>]</span><br><span class="line">env = Environment(ENV = &#123;<span class="string">'PATH'</span> : path&#125;)</span><br><span class="line"></span><br><span class="line">env[<span class="string">'ENV'</span>][<span class="string">'PATH'</span>] = [<span class="string">'/usr/local/bin'</span>, <span class="string">'/bin'</span>, <span class="string">'/usr/bin'</span>]</span><br><span class="line">env[<span class="string">'ENV'</span>][<span class="string">'PATH'</span>] = <span class="string">'/usr/local/bin:/bin:/usr/bin'</span></span><br><span class="line"></span><br><span class="line">因为是 scons 的配置文件是以 python 的环境执行的 所以 你可以使用 os.environ[<span class="string">'PATH'</span>] 获取环境变量, 例子如下:</span><br><span class="line">这样做,可以让自己的代码可移植,跨平台</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">env = Environment(ENV = &#123;<span class="string">'PATH'</span> : os.environ[<span class="string">'PATH'</span>]&#125;)</span><br><span class="line"></span><br><span class="line">或者你可以将整个 环境变量 全部赋值给 ENV</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">env = Environment(ENV = os.environ)</span><br><span class="line"></span><br><span class="line">你可以在已有的环境变量中 拼接 scons 提供如下的 方法:</span><br><span class="line">PrependENVPath()</span><br><span class="line">AppendENVPath()</span><br><span class="line">env =环境(ENV = os.environ)</span><br><span class="line">env.PrependENVPath(<span class="string">'PATH'</span>，<span class="string">'/ usr / local / bin'</span>)</span><br><span class="line">env.AppendENVPath(<span class="string">'LIB'</span>，<span class="string">'/ usr / local / lib'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="使用外部工具"><a href="#使用外部工具" class="headerlink" title="使用外部工具"></a>使用外部工具</h3><p>使用外部工具的时候 scons 默认的搜索路径:<br>scons 内置工具目录<br>Sconstruct 同级目录下/site_scons/site_tools/</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Builtin tool or tool located within site_tools</span></span><br><span class="line">env = Environment(tools = [<span class="string">'SomeTool'</span>])</span><br><span class="line">env.SomeTool(targets, sources)</span><br><span class="line"></span><br><span class="line"><span class="comment"># The search locations would include by default</span></span><br><span class="line">SCons/Tool/SomeTool.py</span><br><span class="line">SCons/Tool/SomeTool/__init__.py</span><br><span class="line">./site_scons/site_tools/SomeTool.py</span><br><span class="line">./site_scons/site_tools/SomeTool/__init__.py</span><br><span class="line"></span><br><span class="line">也可以给 添加 除了 scons 默认搜索路径</span><br><span class="line"><span class="comment"># Tool located within the toolpath directory option</span></span><br><span class="line">env = Environment(tools = [<span class="string">'SomeTool'</span>], toolpath = [<span class="string">'/opt/SomeToolPath'</span>, <span class="string">'/opt/SomeToolPath2'</span>])</span><br><span class="line">env.SomeTool(targets, sources)</span><br><span class="line"></span><br><span class="line"><span class="comment"># The search locations in this example would include:</span></span><br><span class="line">/opt/SomeToolPath/SomeTool.py</span><br><span class="line">/opt/SomeToolPath/SomeTool/__init__.py</span><br><span class="line">/opt/SomeToolPath2/SomeTool.py</span><br><span class="line">/opt/SomeToolPath2/SomeTool/__init__.py</span><br><span class="line">SCons/Tool/SomeTool.py</span><br><span class="line">SCons/Tool/SomeTool/__init__.py</span><br><span class="line">./site_scons/site_tools/SomeTool.py</span><br><span class="line">./site_scons/site_tools/SomeTool/__init__.py</span><br><span class="line"></span><br><span class="line">嵌套工具</span><br><span class="line"><span class="comment"># namespaced target</span></span><br><span class="line">env = Environment(tools = [<span class="string">'SubDir1.SubDir2.SomeTool'</span>], toolpath = [<span class="string">'/opt/SomeToolPath'</span>])</span><br><span class="line">env.SomeTool(targets, sources)</span><br><span class="line"></span><br><span class="line"><span class="comment"># With this example the search locations would include</span></span><br><span class="line">/opt/SomeToolPath/SubDir1/SubDir2/SomeTool.py</span><br><span class="line">/opt/SomeToolPath/SubDir1/SubDir2/SomeTool/__init__.py</span><br><span class="line">SCons/Tool/SubDir1/SubDir2/SomeTool.py</span><br><span class="line">SCons/Tool/SubDir1/SubDir2/SomeTool/__init__.py</span><br><span class="line">./site_scons/site_tools/SubDir1/SubDir2/SomeTool.py</span><br><span class="line">./site_scons/site_tools/SubDir1/SubDir2/SomeTool/__init__.py</span><br><span class="line"></span><br><span class="line">使用 sys.path 作为扩展的工具路径</span><br><span class="line"><span class="comment"># namespaced target using sys.path within toolpath</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">searchpaths = []</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> sys.path:</span><br><span class="line">    <span class="keyword">if</span> os.path.isdir(item): searchpaths.append(item)</span><br><span class="line"></span><br><span class="line">env = Environment(tools = [<span class="string">'someinstalledpackage.SomeTool'</span>], toolpath = searchpaths)</span><br><span class="line">env.SomeTool(targets, sources)</span><br><span class="line"></span><br><span class="line">你可以使用这个包 来避免使用 pip 安装包 拼接前面复杂的路径</span><br><span class="line"><span class="comment"># namespaced target using sys.path</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">env = Environment(tools = [<span class="string">'SomeTool'</span>], toolpath = [PyPackageDir(<span class="string">'tools_example.subdir1.subdir2'</span>)])</span><br><span class="line">env.SomeTool(targets, sources)</span><br></pre></td></tr></table></figure>
<hr>
<p>这次你了解 构造变量的这几个方法<br>MergeFlags, ParseFlags, and ParseConfig methods of a construction environment<br>MergeFlags, ParseFlags ParseConfig</p>
<p>###<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">MergeFlags</span><br><span class="line">尝试合并某个构造变量 例子如下:</span><br><span class="line"></span><br><span class="line">env = Environment()</span><br><span class="line">env.Append(CCFLAGS = <span class="string">'-option -O3 -O1'</span>)</span><br><span class="line">flags = &#123; <span class="string">'CCFLAGS'</span> : <span class="string">'-whatever -O3'</span> &#125;</span><br><span class="line">env.MergeFlags(flags)</span><br><span class="line"><span class="keyword">print</span> env[<span class="string">'CCFLAGS'</span>]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;&gt;</span><br><span class="line">scons -Q</span><br><span class="line">[<span class="string">'-option'</span>, <span class="string">'-O1'</span>, <span class="string">'-whatever'</span>, <span class="string">'-O3'</span>]</span><br><span class="line">scons: <span class="string">'.'</span> <span class="keyword">is</span> up to date.</span><br><span class="line"></span><br><span class="line">env = Environment()</span><br><span class="line">env.Append(CPPPATH = [<span class="string">'/include'</span>, <span class="string">'/usr/local/include'</span>, <span class="string">'/usr/include'</span>])</span><br><span class="line">flags = &#123; <span class="string">'CPPPATH'</span> : [<span class="string">'/usr/opt/include'</span>, <span class="string">'/usr/local/include'</span>] &#125;</span><br><span class="line">env.MergeFlags(flags)</span><br><span class="line"><span class="keyword">print</span> env[<span class="string">'CPPPATH'</span>]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;&gt;</span><br><span class="line">scons -Q</span><br><span class="line">[<span class="string">'/include'</span>, <span class="string">'/usr/local/include'</span>, <span class="string">'/usr/include'</span>, <span class="string">'/usr/opt/include'</span>]</span><br><span class="line">scons: <span class="string">'.'</span> <span class="keyword">is</span> up to date.</span><br><span class="line"></span><br><span class="line">如果我们这个方法传递的不是列表 scons 会自动调用 ParseFlags 将其解析成列表</span><br><span class="line">env = Environment()</span><br><span class="line">env.Append(CCFLAGS = <span class="string">'-option -O3 -O1'</span>)</span><br><span class="line">env.Append(CPPPATH = [<span class="string">'/include'</span>, <span class="string">'/usr/local/include'</span>, <span class="string">'/usr/include'</span>])</span><br><span class="line">env.MergeFlags(<span class="string">'-whatever -I/usr/opt/include -O3 -I/usr/local/include'</span>)</span><br><span class="line"><span class="keyword">print</span> env[<span class="string">'CCFLAGS'</span>]</span><br><span class="line"><span class="keyword">print</span> env[<span class="string">'CPPPATH'</span>]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;&gt;</span><br><span class="line">scons -Q</span><br><span class="line">[<span class="string">'-option'</span>, <span class="string">'-O1'</span>, <span class="string">'-whatever'</span>, <span class="string">'-O3'</span>]</span><br><span class="line">[<span class="string">'/include'</span>, <span class="string">'/usr/local/include'</span>, <span class="string">'/usr/include'</span>, <span class="string">'/usr/opt/include'</span>]</span><br><span class="line">scons: `.<span class="string">' is up to date.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ParseFlags </span></span><br><span class="line"><span class="string">[ParseFlags](https://scons.org/doc/production/HTML/scons-user/ch08s02.html)</span></span><br><span class="line"><span class="string">讲一个有规律的字符串 解析成一个字典列表</span></span><br><span class="line"><span class="string">-I 指要包含的 源码路径</span></span><br><span class="line"><span class="string">-L 库文件的路径</span></span><br><span class="line"><span class="string">env = Environment()</span></span><br><span class="line"><span class="string">d = env.ParseFlags("-I/opt/include -L/opt/lib -lfoo")</span></span><br><span class="line"><span class="string">for k,v in sorted(d.items()):</span></span><br><span class="line"><span class="string">    if v:</span></span><br><span class="line"><span class="string">        print k, v</span></span><br><span class="line"><span class="string">env.MergeFlags(d)</span></span><br><span class="line"><span class="string">env.Program('</span>f1.c<span class="string">')</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">支持递归输入 主要是看例子 和输出结果去理解这些东西, 这里官方也没有解释的太清楚 后面还得多去实践的真知</span></span><br><span class="line"><span class="string">env = Environment()</span></span><br><span class="line"><span class="string">d = env.ParseFlags(["-I/opt/include", ["-L/opt/lib", "-lfoo"]])</span></span><br><span class="line"><span class="string">for k,v in sorted(d.items()):</span></span><br><span class="line"><span class="string">    if v:</span></span><br><span class="line"><span class="string">        print k, v</span></span><br><span class="line"><span class="string">env.MergeFlags(d)</span></span><br><span class="line"><span class="string">env.Program('</span>f1.c<span class="string">')</span></span><br><span class="line"><span class="string">&gt;&gt;&gt;&gt;</span></span><br><span class="line"><span class="string">% scons -Q</span></span><br><span class="line"><span class="string">CPPPATH ['</span>/opt/include<span class="string">']</span></span><br><span class="line"><span class="string">LIBPATH ['</span>/opt/li<span class="string">b']</span></span><br><span class="line"><span class="string">LIBS ['</span>foo<span class="string">']</span></span><br><span class="line"><span class="string">cc -o f1.o -c -I/opt/include f1.c</span></span><br><span class="line"><span class="string">cc -o f1 f1.o -L/opt/lib -lfoo</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ParseConfig</span></span><br><span class="line"><span class="string">这个东西没有看明白 这里先记录一下链接</span></span><br><span class="line"><span class="string">Finding Installed Library Information: the ParseConfig Function</span></span><br><span class="line"><span class="string">[ParseConfig](https://scons.org/doc/production/HTML/scons-user/ch08s03.html)</span></span><br></pre></td></tr></table></figure></p>
<h3 id="在构建程序的时候-帮助信息"><a href="#在构建程序的时候-帮助信息" class="headerlink" title="在构建程序的时候 帮助信息"></a>在构建程序的时候 帮助信息</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">Help(<span class="string">"""</span></span><br><span class="line"><span class="string">Type: 'scons program' to build the production program,</span></span><br><span class="line"><span class="string">      'scons debug' to build the debug version.</span></span><br><span class="line"><span class="string">"""</span>, append=<span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line">加上 append = <span class="keyword">True</span> 在下面出现 `Use scons -H <span class="keyword">for</span> help about command-line options.` 这样的字段</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;&gt;</span><br><span class="line"></span><br><span class="line">scons -h</span><br><span class="line">scons: Reading SConscript files ...</span><br><span class="line">scons: done reading SConscript files.</span><br><span class="line"></span><br><span class="line">Type: <span class="string">'scons program'</span> to build the production program,</span><br><span class="line">      <span class="string">'scons debug'</span> to build the debug version.</span><br><span class="line"></span><br><span class="line">Use scons -H <span class="keyword">for</span> help about command-line options.</span><br><span class="line"></span><br><span class="line">你可以缩短的 命令输出 如下这种操作</span><br><span class="line">env = Environment(CCCOMSTR = <span class="string">"Compiling $TARGET"</span>,</span><br><span class="line">                  LINKCOMSTR = <span class="string">"Linking $TARGET"</span>)</span><br><span class="line">env.Program(<span class="string">'foo.c'</span>)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;&gt;</span><br><span class="line">% scons -Q</span><br><span class="line">Compiling foo.o</span><br><span class="line">Linking foo</span><br><span class="line"></span><br><span class="line">比如下面的例子 如果用户输入的 详细字段不为 <span class="keyword">True</span> 则自定义 编译命令 其实是简短编译命令</span><br><span class="line">env = Environment()</span><br><span class="line"><span class="keyword">if</span> ARGUMENTS.get(<span class="string">'VERBOSE'</span>) != <span class="string">"1':</span></span><br><span class="line"><span class="string">    env['CCCOMSTR'] = "</span>Compiling $TARGET<span class="string">"</span></span><br><span class="line"><span class="string">    env['LINKCOMSTR'] = "</span>Linking $TARGET<span class="string">"</span></span><br><span class="line"><span class="string">env.Program('foo.c')</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Progress 控制流程输出</span></span><br><span class="line"><span class="string">[Progress](https://scons.org/doc/production/HTML/scons-user/ch09s03.html)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">GetBuildFailures</span></span><br><span class="line"><span class="string">[打印详细的错误信息](https://scons.org/doc/production/HTML/scons-user/ch09s04.html)</span></span><br></pre></td></tr></table></figure>
<h3 id="从命令行控制构建流程"><a href="#从命令行控制构建流程" class="headerlink" title="从命令行控制构建流程"></a>从命令行控制构建流程</h3><p><a href="https://scons.org/doc/production/HTML/scons-user/ch10.html">传送门</a><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;&gt; 如果你想使用者调用一些除了scons提供的指令,你可以这样做</span><br><span class="line"></span><br><span class="line">ARGUMENTS 这个东西将会帮到你.</span><br><span class="line">但是有个缺陷是不能存储两个值,只能 key-value 的形式.</span><br><span class="line">ARGUMENTS.get() 获取 debug 这个指令 没有用后面的默认值</span><br><span class="line"></span><br><span class="line">env = Environment()</span><br><span class="line">debug = ARGUMENTS.get(<span class="string">'debug'</span>, <span class="number">0</span>)</span><br><span class="line"><span class="keyword">if</span> int(debug):</span><br><span class="line">    env.Append(CCFLAGS = <span class="string">'-g'</span>)</span><br><span class="line">env.Program(<span class="string">'prog.c'</span>)</span><br><span class="line"></span><br><span class="line">ej:</span><br><span class="line">scons -Q debug=<span class="number">0</span></span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;&gt; 如果你想 一对多 你可以使用这个东西</span><br><span class="line">ARGLIST</span><br><span class="line"></span><br><span class="line">cppdefines = []</span><br><span class="line"><span class="keyword">for</span> key, value <span class="keyword">in</span> ARGLIST:</span><br><span class="line">    <span class="keyword">if</span> key == <span class="string">'define'</span>:</span><br><span class="line">        cppdefines.append(value)</span><br><span class="line">env = Environment(CPPDEFINES = cppdefines)</span><br><span class="line">env.Object(<span class="string">'prog.c'</span>)</span><br><span class="line"></span><br><span class="line">ej: scons -Q define=FOO define=BAR</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;&gt; 从文件中读取用户构建配置</span><br><span class="line">&gt;&gt;&gt;&gt; 会读取 custom.py 文件的配置表</span><br><span class="line">vars = Variables(<span class="string">'custom.py'</span>)</span><br><span class="line">vars.Add(<span class="string">'RELEASE'</span>, <span class="string">'Set to 1 to build for release'</span>, <span class="number">0</span>)</span><br><span class="line">env = Environment(variables = vars,</span><br><span class="line">                  CPPDEFINES=&#123;<span class="string">'RELEASE_BUILD'</span> : <span class="string">'$&#123;RELEASE&#125;'</span>&#125;)</span><br><span class="line">env.Program([<span class="string">'foo.c'</span>, <span class="string">'bar.c'</span>])</span><br><span class="line">Help(vars.GenerateHelpText(env))</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;&gt; custom.py</span><br><span class="line">&gt;&gt;&gt;&gt; RELEASE=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;&gt; 可以结合 两种做法 读取用户 在命令行输入或则是配置文件</span><br><span class="line">&gt;&gt;&gt;&gt; 其中 本地配置文件会首先 覆盖 命令行 的 配置</span><br><span class="line">vars = Variables(<span class="string">'custom.py'</span>,ARGUMENTS)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;&gt; 定义构造变量的函数</span><br><span class="line">&gt;&gt;&gt;&gt; Bool 可以指定的值有 true =&gt; t on all 1 true    False =&gt; f 0 no false</span><br><span class="line"></span><br><span class="line">vars = Variables(<span class="string">'custom.py'</span>)</span><br><span class="line">vars.Add(BoolVariable(<span class="string">'RELEASE'</span>, <span class="string">'Set to build for release'</span>, <span class="number">0</span>))</span><br><span class="line">env = Environment(variables = vars,</span><br><span class="line">                  CPPDEFINES=&#123;<span class="string">'RELEASE_BUILD'</span> : <span class="string">'$&#123;RELEASE&#125;'</span>&#125;)</span><br><span class="line">env.Program(<span class="string">'foo.c'</span>)</span><br><span class="line"></span><br><span class="line">ej:</span><br><span class="line">scons -Q RELEASE=yes foo.o</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;&gt; Enum 有个 allowed_values 的字段 定义枚举变量值</span><br><span class="line">&gt;&gt;&gt;&gt; map 字段备用映射名 map=&#123;<span class="string">'navy'</span>:<span class="string">'blue'</span>&#125;,</span><br><span class="line">&gt;&gt;&gt;&gt; ignorecase=<span class="number">1</span> 忽略 指定指令的大小写  如 COLOR=NaVy</span><br><span class="line"></span><br><span class="line">vars = Variables(<span class="string">'custom.py'</span>)</span><br><span class="line">vars.Add(EnumVariable(<span class="string">'COLOR'</span>, <span class="string">'Set background color'</span>, <span class="string">'red'</span>,</span><br><span class="line">                    allowed_values=(<span class="string">'red'</span>, <span class="string">'green'</span>, <span class="string">'blue'</span>)))</span><br><span class="line">env = Environment(variables = vars,</span><br><span class="line">                  CPPDEFINES=&#123;<span class="string">'COLOR'</span> : <span class="string">'"$&#123;COLOR&#125;"'</span>&#125;)</span><br><span class="line">env.Program(<span class="string">'foo.c'</span>)</span><br><span class="line"></span><br><span class="line">ej: scons -Q COLOR=red</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;&gt; ListVariable 允许一个字段指定多个值</span><br><span class="line">&gt;&gt;&gt;&gt; 允许使用 all 或则是 none</span><br><span class="line"></span><br><span class="line">vars = Variables(<span class="string">'custom.py'</span>)</span><br><span class="line">vars.Add(ListVariable(<span class="string">'COLORS'</span>, <span class="string">'List of colors'</span>, <span class="number">0</span>,</span><br><span class="line">                    [<span class="string">'red'</span>, <span class="string">'green'</span>, <span class="string">'blue'</span>]))</span><br><span class="line">env = Environment(variables = vars,</span><br><span class="line">                  CPPDEFINES=&#123;<span class="string">'COLORS'</span> : <span class="string">'"$&#123;COLORS&#125;"'</span>&#125;)</span><br><span class="line">env.Program(<span class="string">'foo.c'</span>)</span><br><span class="line"></span><br><span class="line">ej: scons -Q COLORS=red,blue foo.o =&gt; cc -o foo.o -c -DCOLORS="red blue" foo.c</span><br><span class="line">ej: scons -Q COLORS=all foo.o =&gt; cc -o foo.o -c -DCOLORS="red green blue" foo.c</span><br><span class="line">ej: scons -Q COLORS=none foo.o =&gt; cc -o foo.o -c -DCOLORS="" foo.c</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;&gt; PathVariable 路径变量</span><br><span class="line">&gt;&gt;&gt;&gt; 提供输入的路径是文件 PathVariable.PathIsFile</span><br><span class="line">&gt;&gt;&gt;&gt; 是目录 PathVariable.PathIsDir</span><br><span class="line">&gt;&gt;&gt;&gt; 目录不存在,并创建 PathVariable.PathIsDirCreate</span><br><span class="line">&gt;&gt;&gt;&gt; 不关心上面的三点 PathVariable.PathAccept</span><br><span class="line"></span><br><span class="line">ej:</span><br><span class="line">vars = Variables(<span class="string">'custom.py'</span>)</span><br><span class="line">vars.Add(PathVariable(<span class="string">'CONFIG'</span>,</span><br><span class="line">                    <span class="string">'Path to configuration file'</span>,</span><br><span class="line">                    <span class="string">'/etc/my_config'</span>,</span><br><span class="line">                    PathVariable.PathIsFile))</span><br><span class="line">env = Environment(variables = vars,</span><br><span class="line">                  CPPDEFINES=&#123;<span class="string">'CONFIG_FILE'</span> : <span class="string">'"$CONFIG"'</span>&#125;)</span><br><span class="line">env.Program(<span class="string">'foo.c'</span>)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;&gt; PackageVariable</span><br><span class="line">&gt;&gt;&gt;&gt; 启用或禁止 路径名字 没有太懂</span><br><span class="line">vars = Variables(<span class="string">'custom.py'</span>)</span><br><span class="line">vars.Add(PackageVariable(<span class="string">'PACKAGE'</span>,</span><br><span class="line">                       <span class="string">'Location package'</span>,</span><br><span class="line">                       <span class="string">'/opt/location'</span>))</span><br><span class="line">env = Environment(variables = vars,</span><br><span class="line">                  CPPDEFINES=&#123;<span class="string">'PACKAGE'</span> : <span class="string">'"$PACKAGE"'</span>&#125;)</span><br><span class="line">env.Program(<span class="string">'foo.c'</span>)</span><br><span class="line"></span><br><span class="line">ej:</span><br><span class="line">% scons -Q foo.o</span><br><span class="line">cc -o foo.o -c -DPACKAGE=<span class="string">"/opt/location"</span> foo.c</span><br><span class="line">% scons -Q PACKAGE=/usr/local/location foo.o</span><br><span class="line">cc -o foo.o -c -DPACKAGE=<span class="string">"/usr/local/location"</span> foo.c</span><br><span class="line">% scons -Q PACKAGE=yes foo.o</span><br><span class="line">cc -o foo.o -c -DPACKAGE=<span class="string">"True"</span> foo.c</span><br><span class="line">% scons -Q PACKAGE=no foo.o</span><br><span class="line">cc -o foo.o -c -DPACKAGE=<span class="string">"False"</span> foo.c</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;&gt; AddVariables 一次性添加多个变量功能</span><br><span class="line"></span><br><span class="line">vars = Variables()</span><br><span class="line">vars.AddVariables(</span><br><span class="line">    (<span class="string">'RELEASE'</span>, <span class="string">'Set to 1 to build for release'</span>, <span class="number">0</span>),</span><br><span class="line">    (<span class="string">'CONFIG'</span>, <span class="string">'Configuration file'</span>, <span class="string">'/etc/my_config'</span>),</span><br><span class="line">    BoolVariable(<span class="string">'warnings'</span>, <span class="string">'compilation with -Wall and similiar'</span>, <span class="number">1</span>),</span><br><span class="line">    EnumVariable(<span class="string">'debug'</span>, <span class="string">'debug output and symbols'</span>, <span class="string">'no'</span>,</span><br><span class="line">               allowed_values=(<span class="string">'yes'</span>, <span class="string">'no'</span>, <span class="string">'full'</span>),</span><br><span class="line">               map=&#123;&#125;, ignorecase=<span class="number">0</span>),  <span class="comment"># case sensitive</span></span><br><span class="line">    ListVariable(<span class="string">'shared'</span>,</span><br><span class="line">               <span class="string">'libraries to build as shared libraries'</span>,</span><br><span class="line">               <span class="string">'all'</span>,</span><br><span class="line">               names = list_of_libs),</span><br><span class="line">    PackageVariable(<span class="string">'x11'</span>,</span><br><span class="line">                  <span class="string">'use X11 installed here (yes = search some places)'</span>,</span><br><span class="line">                  <span class="string">'yes'</span>),</span><br><span class="line">    PathVariable(<span class="string">'qtdir'</span>, <span class="string">'where the root of Qt is installed'</span>, qtdir),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;&gt; UnknownVariables 在用户使用了未定义的 指令时 你可以警告调用者 拼写错误 并退出程序</span><br><span class="line"></span><br><span class="line">vars = Variables(<span class="keyword">None</span>)</span><br><span class="line">vars.Add(<span class="string">'RELEASE'</span>, <span class="string">'Set to 1 to build for release'</span>, <span class="number">0</span>)</span><br><span class="line">env = Environment(variables = vars,</span><br><span class="line">                  CPPDEFINES=&#123;<span class="string">'RELEASE_BUILD'</span> : <span class="string">'$&#123;RELEASE&#125;'</span>&#125;)</span><br><span class="line">unknown = vars.UnknownVariables()</span><br><span class="line"><span class="keyword">if</span> unknown:</span><br><span class="line">    print(<span class="string">"Unknown variables: %s"</span>%unknown.keys())</span><br><span class="line">    Exit(<span class="number">1</span>)</span><br><span class="line">env.Program(<span class="string">'foo.c'</span>)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;&gt; 你可以在用户使用某个命令的时候 提醒用户一些操作</span><br><span class="line"><span class="keyword">if</span> <span class="string">'bar'</span> <span class="keyword">in</span> COMMAND_LINE_TARGETS:</span><br><span class="line">    print(<span class="string">"Don't forget to copy `bar' to the archive!"</span>)</span><br><span class="line">Default(Program(<span class="string">'foo.c'</span>))</span><br><span class="line">Program(<span class="string">'bar.c'</span>)</span><br><span class="line"></span><br><span class="line">ej:</span><br><span class="line">% scons -Q bar</span><br><span class="line">Don<span class="string">'t forget to copy `bar'</span> to the archive!</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;&gt; Default() 用户没有指定构建是 可以使用 这个函数 默认 构建一个程序</span><br><span class="line">env = Environment()</span><br><span class="line">hello = env.Program(<span class="string">'hello.c'</span>)</span><br><span class="line">env.Program(<span class="string">'goodbye.c'</span>)</span><br><span class="line">Default(hello)</span><br><span class="line"></span><br><span class="line">ej:</span><br><span class="line">    % scons -Q</span><br><span class="line">    cc -o hello.o -c hello.c</span><br><span class="line">    cc -o hello hello.o</span><br><span class="line">    % scons -Q</span><br><span class="line">    scons: `hello<span class="string">' is up to date.</span></span><br><span class="line"><span class="string">    % scons -Q goodbye</span></span><br><span class="line"><span class="string">    cc -o goodbye.o -c goodbye.c</span></span><br><span class="line"><span class="string">    cc -o goodbye goodbye.o</span></span><br><span class="line"><span class="string">Default 跟过用法 [传送门](https://scons.org/doc/production/HTML/scons-user/ch10s03.html)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&gt;&gt;&gt;&gt; DEFAULT_TARGETS 主要是迎合上面 Default 函数, 看一下例子应该很容易理解</span></span><br><span class="line"><span class="string">prog1 = Program('</span>prog1.c<span class="string">')</span></span><br><span class="line"><span class="string">Default(prog1)</span></span><br><span class="line"><span class="string">print("DEFAULT_TARGETS is %s"%map(str, DEFAULT_TARGETS))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ej:</span></span><br><span class="line"><span class="string">% scons</span></span><br><span class="line"><span class="string">scons: Reading SConscript files ...</span></span><br><span class="line"><span class="string">DEFAULT_TARGETS is ['</span>prog1<span class="string">']</span></span><br><span class="line"><span class="string">scons: done reading SConscript files.</span></span><br><span class="line"><span class="string">scons: Building targets ...</span></span><br><span class="line"><span class="string">cc -o prog1.o -c prog1.c</span></span><br><span class="line"><span class="string">cc -o prog1 prog1.o</span></span><br><span class="line"><span class="string">scons: done building targets.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&gt;&gt;&gt;&gt; BUILD_TARGETS</span></span><br><span class="line"><span class="string">prog1 = Program('</span>prog1.c<span class="string">')</span></span><br><span class="line"><span class="string">Program('</span>prog2.c<span class="string">')</span></span><br><span class="line"><span class="string">Default(prog1)</span></span><br><span class="line"><span class="string">print ("BUILD_TARGETS is %s"%map(str, BUILD_TARGETS))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ej:</span></span><br><span class="line"><span class="string">% scons -Q</span></span><br><span class="line"><span class="string">BUILD_TARGETS is ['</span>prog1<span class="string">']</span></span><br><span class="line"><span class="string">cc -o prog1.o -c prog1.c</span></span><br><span class="line"><span class="string">cc -o prog1 prog1.o</span></span><br><span class="line"><span class="string">% scons -Q prog2</span></span><br><span class="line"><span class="string">BUILD_TARGETS is ['</span>prog2<span class="string">']</span></span><br><span class="line"><span class="string">cc -o prog2.o -c prog2.c</span></span><br><span class="line"><span class="string">cc -o prog2 prog2.o</span></span><br><span class="line"><span class="string">% scons -Q -c .</span></span><br><span class="line"><span class="string">BUILD_TARGETS is ['</span>.<span class="string">']</span></span><br><span class="line"><span class="string">Removed prog1.o</span></span><br><span class="line"><span class="string">Removed prog1</span></span><br><span class="line"><span class="string">Removed prog2.o</span></span><br><span class="line"><span class="string">Removed prog2</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&gt;&gt;&gt;&gt; 产生帮助文档(help)</span></span><br><span class="line"><span class="string">vars = Variables(None, ARGUMENTS)</span></span><br><span class="line"><span class="string">vars.Add('</span>RELEASE<span class="string">', '</span>Set to <span class="number">1</span> to build <span class="keyword">for</span> release<span class="string">', 0)</span></span><br><span class="line"><span class="string">env = Environment(variables = vars)</span></span><br><span class="line"><span class="string">Help(vars.GenerateHelpText(env))</span></span><br></pre></td></tr></table></figure></p>
<h3 id="InstallBuilder-安装构建的可执行程序"><a href="#InstallBuilder-安装构建的可执行程序" class="headerlink" title="InstallBuilder 安装构建的可执行程序"></a>InstallBuilder 安装构建的可执行程序</h3><p>安装暂时没有 显示功能上需求就不做详细叙述了<br><a href="https://scons.org/doc/production/HTML/scons-user/ch11.html">传送门</a></p>
<h3 id="与平台无关的文件操作"><a href="#与平台无关的文件操作" class="headerlink" title="与平台无关的文件操作"></a>与平台无关的文件操作</h3><p>scons 封装了 与平台无关的文件操作<br>如: 拷贝(copy),移动(move),移除(delete),创建(touch),创建目录(mkdir),执行(execute)<br><a href="https://scons.org/doc/production/HTML/scons-user/ch12.html">传送门</a>WWW</p>
<h3 id="控制构建目标的移除"><a href="#控制构建目标的移除" class="headerlink" title="控制构建目标的移除"></a>控制构建目标的移除</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;&gt; 有的时候你想要在每次构建一个东西的时候,不清除上一次的构建,而是以增量的方式构建</span><br><span class="line">&gt;&gt;&gt;&gt; Precious</span><br><span class="line">env = Environment(RANLIBCOM=<span class="string">''</span>)</span><br><span class="line">lib = env.Library(<span class="string">'foo'</span>, [<span class="string">'f1.c'</span>, <span class="string">'f2.c'</span>, <span class="string">'f3.c'</span>])</span><br><span class="line">env.Precious(lib)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;&gt; 有的时候你可能使用 scons -c 但是这个命令会将所有的构建产物都移除掉,你可以使用这个命令,保证有些东西不被 -c 指令 给移除掉</span><br><span class="line">&gt;&gt;&gt;&gt; NoClean</span><br><span class="line">env = Environment(RANLIBCOM=<span class="string">''</span>)</span><br><span class="line">lib = env.Library(<span class="string">'foo'</span>, [<span class="string">'f1.c'</span>, <span class="string">'f2.c'</span>, <span class="string">'f3.c'</span>])</span><br><span class="line">env.NoClean(lib)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;&gt; Clean 有的时候你可能 清楚自己在产生过程中生成的 自定义文件 你可以这样做</span><br><span class="line">t = Command(<span class="string">'foo.out'</span>, <span class="string">'foo.in'</span>, <span class="string">'build -o $TARGET $SOURCE'</span>)</span><br><span class="line">Clean(t, <span class="string">'foo.log'</span>)</span><br><span class="line"></span><br><span class="line">ej:</span><br><span class="line">% scons -Q</span><br><span class="line">build -o foo.out foo.<span class="keyword">in</span></span><br><span class="line">% scons -Q -c</span><br><span class="line">Removed foo.out</span><br><span class="line">Removed foo.log</span><br></pre></td></tr></table></figure>
<h3 id="分级构建"><a href="#分级构建" class="headerlink" title="分级构建"></a>分级构建</h3><p>分级构建,就是你的源文件可能不是一个目录,需要多一个目录构建.<br><a href="https://scons.org/doc/production/HTML/scons-user/ch14.html">传送门</a><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;&gt; SConscript 根目录调用每个子目录的 构建脚本, 通常子目录的构建脚本叫 SConscript 这是官方的解释</span><br><span class="line">SConscript([<span class="string">'drivers/display/SConscript'</span>,</span><br><span class="line">            <span class="string">'drivers/mouse/SConscript'</span>,</span><br><span class="line">            <span class="string">'parser/SConscript'</span>,</span><br><span class="line">            <span class="string">'utilities/SConscript'</span>])</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;&gt; 通常里面的路径都是相对于当前这个构建脚本 如果你先让子构建脚本 使用顶级目录你可以这样做 加上 <span class="string">'#'</span> 这个符号</span><br><span class="line">env = Environment()</span><br><span class="line">env.Program(<span class="string">'prog'</span>, [<span class="string">'main.c'</span>, <span class="string">'#lib/foo1.c'</span>, <span class="string">'foo2.c'</span>])</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;&gt; 当然你也可以直接使用绝对路径 不需要加任何符号</span><br><span class="line">&gt;&gt;&gt;&gt; </span><br><span class="line">&gt;&gt;&gt;&gt; 你可以在多个构建脚本共享变量 你可以使用 Export Import 这两个方法</span><br><span class="line"></span><br><span class="line">ej:</span><br><span class="line">env = Environment()</span><br><span class="line">Export(env)</span><br><span class="line"></span><br><span class="line"><span class="keyword">or</span>:</span><br><span class="line">env = Environment()</span><br><span class="line">debug = <span class="number">10</span></span><br><span class="line">Export(env, debug)</span><br><span class="line"></span><br><span class="line"><span class="keyword">or</span>:</span><br><span class="line">Export(<span class="string">'env debug'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">or</span>:</span><br><span class="line">SConscript(<span class="string">'src/SConscript'</span>, <span class="string">'env'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">or</span>:</span><br><span class="line">SConscript(<span class="string">'src/SConscript'</span>, exports=<span class="string">'env'</span>)</span><br><span class="line"></span><br><span class="line">ej:</span><br><span class="line">Import(env)</span><br><span class="line"></span><br><span class="line">Import(env, debug)</span><br><span class="line"></span><br><span class="line">Import(<span class="string">'env debug'</span>)</span><br><span class="line"></span><br><span class="line">Import(<span class="string">'*'</span>)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;&gt; 有事你需要 从两个此目录返回结果 构建出一个对象</span><br><span class="line">env = Environment()</span><br><span class="line">Export(<span class="string">'env'</span>)</span><br><span class="line">objs = []</span><br><span class="line"><span class="keyword">for</span> subdir <span class="keyword">in</span> [<span class="string">'foo'</span>, <span class="string">'bar'</span>]:</span><br><span class="line">    o = SConscript(<span class="string">'%s/SConscript'</span> % subdir)</span><br><span class="line">    objs.append(o)</span><br><span class="line">env.Library(<span class="string">'prog'</span>, objs)</span><br><span class="line"></span><br><span class="line">other Sconstruct(其他构建脚本):</span><br><span class="line">    Import(<span class="string">'env'</span>)</span><br><span class="line">    obj = env.Object(<span class="string">'foo.c'</span>)</span><br><span class="line">    Return(<span class="string">'obj'</span>)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="分离构建-目标-和-源文件"><a href="#分离构建-目标-和-源文件" class="headerlink" title="分离构建 目标 和 源文件"></a>分离构建 目标 和 源文件</h3><p>分离构建结果<br><a href="https://scons.org/doc/production/HTML/scons-user/ch15.html">传送门</a><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">方式<span class="number">1</span>:</span><br><span class="line">主要是利用这个字段 variant_dir</span><br><span class="line">SConscript(<span class="string">'src/SConscript'</span>, variant_dir=<span class="string">'build'</span>)</span><br><span class="line"></span><br><span class="line">禁掉在输出目录拷贝源文件</span><br><span class="line">SConscript（<span class="string">'src / SConscript'</span>，variant_dir =<span class="string">'build'</span>，duplicate = <span class="number">0</span>）</span><br><span class="line">方式<span class="number">2</span>:</span><br><span class="line">VariantDir(<span class="string">'build'</span>, <span class="string">'src'</span>, duplicate=<span class="number">0</span>)</span><br><span class="line">env = Environment()</span><br><span class="line">env.Program(<span class="string">'build/hello.c'</span>)</span><br><span class="line"></span><br><span class="line">子脚本</span><br><span class="line">VariantDir(<span class="string">'build'</span>, <span class="string">'src'</span>)</span><br><span class="line">SConscript(<span class="string">'build/SConscript'</span>)</span><br></pre></td></tr></table></figure></p>
<h3 id="变体构建"><a href="#变体构建" class="headerlink" title="变体构建"></a>变体构建</h3><p><a href="https://scons.org/doc/production/HTML/scons-user/ch16.html">传送门</a><br>同一个目录构建不同的目标产物(可执行程序)<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">platform = ARGUMENTS.get(<span class="string">'OS'</span>, Platform())</span><br><span class="line"></span><br><span class="line">include = <span class="string">"#export/$PLATFORM/include"</span></span><br><span class="line">lib = <span class="string">"#export/$PLATFORM/lib"</span></span><br><span class="line">bin = <span class="string">"#export/$PLATFORM/bin"</span></span><br><span class="line"></span><br><span class="line">env = Environment(PLATFORM = platform,</span><br><span class="line">                  BINDIR = bin,</span><br><span class="line">                  INCDIR = include,</span><br><span class="line">                  LIBDIR = lib,</span><br><span class="line">                  CPPPATH = [include],</span><br><span class="line">                  LIBPATH = [lib],</span><br><span class="line">                  LIBS = <span class="string">'world'</span>)</span><br><span class="line"></span><br><span class="line">Export(<span class="string">'env'</span>)</span><br><span class="line"></span><br><span class="line">env.SConscript(<span class="string">'src/SConscript'</span>, variant_dir=<span class="string">'build/$PLATFORM'</span>)</span><br></pre></td></tr></table></figure></p>
<h3 id="国际化"><a href="#国际化" class="headerlink" title="国际化"></a>国际化</h3><p><a href="https://scons.org/doc/production/HTML/scons-user/ch17.html">传送门</a></p>
<h3 id="编写自己的-builder-构造器"><a href="#编写自己的-builder-构造器" class="headerlink" title="编写自己的 builder(构造器)"></a>编写自己的 builder(构造器)</h3><p><a href="https://scons.org/doc/production/HTML/scons-user/ch18.html">传送门</a><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;&gt; 创建构造器</span><br><span class="line">env = Environment()</span><br><span class="line">bld = Builder(action = <span class="string">'foobuild &lt; $SOURCE &gt; $TARGET'</span>)</span><br><span class="line">env.Append(BUILDERS = &#123;<span class="string">'Foo'</span> : bld&#125;)</span><br><span class="line">env.Foo(<span class="string">'file.foo'</span>, <span class="string">'file.input'</span>)</span><br><span class="line">env.Program(<span class="string">'hello.c'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">or</span>:</span><br><span class="line">env = Environment()</span><br><span class="line">bld = Builder(action = <span class="string">'foobuild &lt; $SOURCE &gt; $TARGET'</span>)</span><br><span class="line">env[<span class="string">'BUILDERS'</span>][<span class="string">'Foo'</span>] = bld</span><br><span class="line">env.Foo(<span class="string">'file.foo'</span>, <span class="string">'file.input'</span>)</span><br><span class="line">env.Program(<span class="string">'hello.c'</span>)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;&gt; 指定构建的文件后缀 和 输出文件的后缀</span><br><span class="line">bld = Builder(action = <span class="string">'foobuild &lt; $SOURCE &gt; $TARGET'</span>,</span><br><span class="line">              suffix = <span class="string">'.foo'</span>,</span><br><span class="line">              src_suffix = <span class="string">'.input'</span>)</span><br><span class="line">env = Environment(BUILDERS = &#123;<span class="string">'Foo'</span> : bld&#125;)</span><br><span class="line">env.Foo(<span class="string">'file1'</span>)</span><br><span class="line">env.Foo(<span class="string">'file2'</span>)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;&gt; 构建是调用 python 命令 </span><br><span class="line">target:</span><br><span class="line">A list of Node objects representing the target <span class="keyword">or</span> targets to be built by this builder function. The file names of these target(s) may be extracted using the Python str function.</span><br><span class="line">(是一个目标节点列表,可通过 str 的方法 解析里面的内容)</span><br><span class="line">source:</span><br><span class="line">A list of Node objects representing the sources to be used by this builder function to build the targets. The file names of these source(s) may be extracted using the Python str function.</span><br><span class="line">(是一个源节点列表,可通过 str 的方法 解析里面的内容)</span><br><span class="line">env:</span><br><span class="line">The construction environment used <span class="keyword">for</span> building the target(s). The builder function may use any of the environment<span class="string">'s construction variables in any way to affect how it builds the targets.</span></span><br><span class="line"><span class="string">(这个构造变量被用在 目标节点上, 这个构造器可能使用任意的构造环境中的构造变量以任意的方式去影响如何构建目标节点)</span></span><br><span class="line"><span class="string">(这个解释可能有点绕,其实还是挺容易懂得,不是吗?)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&gt;&gt;&gt;&gt; 自定义构建函数 上面是三个参数的解释, 很详细.</span></span><br><span class="line"><span class="string">def build_function(target, source, env):</span></span><br><span class="line"><span class="string">    # Code to build "target" from "source"</span></span><br><span class="line"><span class="string">    return None</span></span><br><span class="line"><span class="string">bld = Builder(action = build_function,</span></span><br><span class="line"><span class="string">              suffix = '</span>.foo<span class="string">',</span></span><br><span class="line"><span class="string">              src_suffix = '</span>.input<span class="string">')</span></span><br><span class="line"><span class="string">env = Environment(BUILDERS = &#123;'</span>Foo<span class="string">' : bld&#125;)</span></span><br><span class="line"><span class="string">env.Foo('</span>file<span class="string">')</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&gt;&gt;&gt;&gt; Generator 产生一条记录信息</span></span><br><span class="line"><span class="string">def generate_actions(source, target, env, for_signature):</span></span><br><span class="line"><span class="string">    return '</span>foobuild &lt; %s &gt; %s<span class="string">' % (source[0], target[0])</span></span><br><span class="line"><span class="string">bld = Builder(generator = generate_actions,</span></span><br><span class="line"><span class="string">              suffix = '</span>.foo<span class="string">',</span></span><br><span class="line"><span class="string">              src_suffix = '</span>.input<span class="string">')</span></span><br><span class="line"><span class="string">env = Environment(BUILDERS = &#123;'</span>Foo<span class="string">' : bld&#125;)</span></span><br><span class="line"><span class="string">env.Foo('</span>file<span class="string">')</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&gt;&gt;&gt;&gt; Builders That Modify the Target or Source Lists Using an Emitter</span></span><br><span class="line"><span class="string">(修改目标节点或者是 源节点 通过发射器)</span></span><br><span class="line"><span class="string">bld = Builder(action = '</span>my_command $SOURCES &gt; $TARGET<span class="string">',</span></span><br><span class="line"><span class="string">              suffix = '</span>.foo<span class="string">',</span></span><br><span class="line"><span class="string">              src_suffix = '</span>.input<span class="string">',</span></span><br><span class="line"><span class="string">              emitter = '</span>$MY_EMITTER<span class="string">')</span></span><br><span class="line"><span class="string">def modify1(target, source, env):</span></span><br><span class="line"><span class="string">    return target, source + ['</span>modify1.<span class="keyword">in</span><span class="string">']</span></span><br><span class="line"><span class="string">def modify2(target, source, env):</span></span><br><span class="line"><span class="string">    return target, source + ['</span>modify2.<span class="keyword">in</span><span class="string">']</span></span><br><span class="line"><span class="string">env1 = Environment(BUILDERS = &#123;'</span>Foo<span class="string">' : bld&#125;,</span></span><br><span class="line"><span class="string">                   MY_EMITTER = modify1)</span></span><br><span class="line"><span class="string">env2 = Environment(BUILDERS = &#123;'</span>Foo<span class="string">' : bld&#125;,</span></span><br><span class="line"><span class="string">                   MY_EMITTER = modify2)</span></span><br><span class="line"><span class="string">env1.Foo('</span>file1<span class="string">')</span></span><br><span class="line"><span class="string">env2.Foo('</span>file2<span class="string">')</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&gt;&gt;&gt;&gt; 放置自定义工具或者是 构造器</span></span><br><span class="line"><span class="string">&gt;&gt;&gt;&gt; scons 会自动加载 site_scons/site_init.py 比任意一个 构建脚本都早</span></span><br><span class="line"><span class="string">&gt;&gt;&gt;&gt; site_scons/site_tools 在顶级的构建脚本是最后执行的 它覆盖其他的构建脚本定义</span></span><br><span class="line"><span class="string">&gt;&gt;&gt;&gt; </span></span><br><span class="line"><span class="string">site_scons/site_init.py</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">def TOOL_ADD_HEADER(env):</span></span><br><span class="line"><span class="string">   """A Tool to add a header from $HEADER to the source file"""</span></span><br><span class="line"><span class="string">   add_header = Builder(action=['</span>echo <span class="string">"$HEADER"</span> &gt; $TARGET<span class="string">',</span></span><br><span class="line"><span class="string">                                '</span>cat $SOURCE &gt;&gt; $TARGET<span class="string">'])</span></span><br><span class="line"><span class="string">   env.Append(BUILDERS = &#123;'</span>AddHeade<span class="string">r' : add_header&#125;)</span></span><br><span class="line"><span class="string">   env['</span>HEADER<span class="string">'] = '</span><span class="string">' # set default value</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">SConstruct</span></span><br><span class="line"><span class="string"># Use TOOL_ADD_HEADER from site_scons/site_init.py</span></span><br><span class="line"><span class="string">env=Environment(tools=['</span>default<span class="string">', TOOL_ADD_HEADER], HEADER="=====")</span></span><br><span class="line"><span class="string">env.AddHeader('</span>tgt<span class="string">', '</span>src<span class="string">')</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">site_scons/my_utils.py</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">from SCons.Script import *   # for Execute and Mkdir</span></span><br><span class="line"><span class="string">def build_id():</span></span><br><span class="line"><span class="string">   """Return a build ID (stub version)"""</span></span><br><span class="line"><span class="string">   return "100"</span></span><br><span class="line"><span class="string">def MakeWorkDir(workdir):</span></span><br><span class="line"><span class="string">   """Create the specified dir immediately"""</span></span><br><span class="line"><span class="string">   Execute(Mkdir(workdir))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">import my_utils</span></span><br><span class="line"><span class="string">print("build_id=" + my_utils.build_id())</span></span><br><span class="line"><span class="string">my_utils.MakeWorkDir('</span>/tmp/work<span class="string">')</span></span><br></pre></td></tr></table></figure></p>
<h3 id="缓存构建的文件"><a href="#缓存构建的文件" class="headerlink" title="缓存构建的文件"></a>缓存构建的文件</h3><p>缓存构建文件其实就是将构建出来的中间产物给放到一个缓存目录里面,如果目录文件不存,就直接构建中间产物,在其下次构建是,就不必再次构建它,提高构建效率.<br><a href="https://scons.org/doc/production/HTML/scons-user/ch24.html">传送门</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;&gt; 主要使用 CacheDir(<span class="string">'./cache'</span>)</span><br><span class="line">&gt;&gt;&gt;&gt; scons -Q  --cache-show  保持每次构建的显示命令都是一样, 不使用这个字段会出现如果在在缓存里面存在,就和没有时的输出不一样,问题.</span><br><span class="line">ej:</span><br><span class="line">    % scons -Q</span><br><span class="line">    cc -o hello.o -c hello.c</span><br><span class="line">    cc -o hello hello.o</span><br><span class="line">    % scons -Q -c</span><br><span class="line">    Removed hello.o</span><br><span class="line">    Removed hello</span><br><span class="line">    % scons -Q --cache-show</span><br><span class="line">    cc -o hello.o -c hello.c</span><br><span class="line">    cc -o hello hello.o</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;&gt; NoCache() 指定某些中间产物,不放入缓存</span><br><span class="line">ej:</span><br><span class="line">    env = Environment()</span><br><span class="line">    obj = env.Object(<span class="string">'hello.c'</span>)</span><br><span class="line">    env.Program(<span class="string">'hello.c'</span>)</span><br><span class="line">    CacheDir(<span class="string">'cache'</span>)</span><br><span class="line">    NoCache(<span class="string">'hello.o'</span>)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;&gt; scons -Q --cache-disable 通过命令行禁掉 缓存</span><br><span class="line">&gt;&gt;&gt;&gt; scons -Q --cache-force 强制更新缓存</span><br><span class="line">&gt;&gt;&gt;&gt; scons -Q --random 随机缓存 或者是使用构建脚本设置 SetOption(<span class="string">'random'</span>, <span class="number">1</span>)</span><br><span class="line">-- random 主要是面对多个程序通同时构建的情况. 让他的构建库的顺序尽量不一致,最小化减少缓存.</span><br></pre></td></tr></table></figure>
<h3 id="验证-python-scons-版本"><a href="#验证-python-scons-版本" class="headerlink" title="验证 python scons 版本"></a>验证 python scons 版本</h3><p>EnsurePythonVersion(2, 5) 验证 python 版本 如果低于构建结束<br>EnsureSConsVersion(1, 0) 验证 scons 版本</p>
<h3 id="别名目标"><a href="#别名目标" class="headerlink" title="别名目标"></a>别名目标</h3><p>别名也没啥说的<br><a href="https://scons.org/doc/production/HTML/scons-user/ch25.html">传送门</a><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">env = Environment()</span><br><span class="line">hello = env.Program(<span class="string">'hello.c'</span>)</span><br><span class="line">env.Install(<span class="string">'/usr/bin'</span>, hello)</span><br><span class="line">env.Alias(<span class="string">'install'</span>, <span class="string">'/usr/bin'</span>)</span><br></pre></td></tr></table></figure></p>
<h3 id="多平台配置（Autoconf功能"><a href="#多平台配置（Autoconf功能" class="headerlink" title="多平台配置（Autoconf功能"></a>多平台配置（Autoconf功能</h3><p>主要是检查某些依赖的文件是否存在等等.<br><a href="https://scons.org/doc/production/HTML/scons-user/ch23.html">传送门</a></p>
<h3 id="从代码存储库构建"><a href="#从代码存储库构建" class="headerlink" title="从代码存储库构建"></a>从代码存储库构建</h3><p><a href="https://scons.org/doc/production/HTML/scons-user/ch22.html">传送门</a></p>
<h3 id="编写扫描仪"><a href="#编写扫描仪" class="headerlink" title="编写扫描仪"></a>编写扫描仪</h3><p><a href="https://scons.org/doc/production/HTML/scons-user/ch21.html">传送门</a></p>
<h3 id="Not-Writing-a-Builder-the-Command-Builder"><a href="#Not-Writing-a-Builder-the-Command-Builder" class="headerlink" title="Not Writing a Builder: the Command Builder"></a>Not Writing a Builder: the Command Builder</h3><p>主要是自定义写构造器的简化版本<br><a href="https://scons.org/doc/production/HTML/scons-user/ch19.html">传送门</a></p>
<h3 id="Pseudo-Builders-the-AddMethod-function-伪造构建起-添加方法"><a href="#Pseudo-Builders-the-AddMethod-function-伪造构建起-添加方法" class="headerlink" title="Pseudo-Builders: the AddMethod function(伪造构建起, 添加方法)"></a>Pseudo-Builders: the AddMethod function(伪造构建起, 添加方法)</h3><p>这个东西个自定义工具差不多<br><a href="https://scons.org/doc/production/HTML/scons-user/ch20.html">传送门</a></p>

        </div>

        <blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2018-12-25T13:46:14.655Z" itemprop="dateUpdated">2018-12-25 21:46:14</time>
</span>


        
        原文链接：<a href="/posts/79065537/" target="_blank" rel="external">https://leng521.top/posts/79065537/</a>
        
    </div>
    <footer>
        <div onclick="location.href='https://leng521.top'">
            <img src="/img/head.jpg" alt="小魏">
            <a>小魏</a>
        </div>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/c/">c++</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/scons/">scons</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://leng521.top/posts/79065537/&title=《scons自动构建工具》 — 小魏的博客&pic=https://leng521.top/img/head.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://leng521.top/posts/79065537/&title=《scons自动构建工具》 — 小魏的博客&source=这篇文章可能有点长,如果你想要学到一些知识,而不是简单入门,你要有耐心的看下去,当然在看的时候,也要自己思考,也许我写的有问题,这个时候你可以再去看看,官..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://leng521.top/posts/79065537/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《scons自动构建工具》 — 小魏的博客&url=https://leng521.top/posts/79065537/&via=https://leng521.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://leng521.top/posts/79065537/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between flex-row-reverse">
  

  
    <div class="waves-block waves-effect next">
      <a href="/posts/41d43874/" id="post-next" class="post-nav-link">
        <h4 class="title" data-hover="下一篇：cocos2dx-JS-OC-Java互相调用">下一篇：cocos2dx-JS-OC-Java互相调用</h4>
      </a>
    </div>
  
</nav>



    
    

    

    
    <!-- Valine Comments -->
    <div class="comments vcomment" id="comments"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script>
    <!-- Valine Comments script -->
    <script>
        var GUEST_INFO = ['nick','mail','link'];
        var guest_info = 'nick,mail,link'.split(',').filter(function(item){
          return GUEST_INFO.indexOf(item) > -1
        });
        new Valine({
            el: '#comments',
            notify: 'false' == 'true',
            verify: 'false' == 'true',
            appId: "VuMjQqCGIaGKlNSxkQYjregm-gzGzoHsz",
            appKey: "HbpDPI0yYswQ7SEDXvzILkIi",
            avatar: "mm",
            placeholder: "Just go go",
            guest_info: guest_info.length == 0 ? GUEST_INFO : guest_info,
            pageSize: "10"
        })
    </script>
    <!-- Valine Comments end -->



</article>

</div>

        <footer class="footer">
    <div class="footer-content">
        <span class="power">
            <i class="icon icon-lg icon-copyright"></i>
            2018
            <i class="icon icon-lg icon-heart"></i>
            <a href="https://leng521.top">leng521.top</a>
            <br/>
            Power by
            <a href="https://hexo.io/" target="_blank" rel="external nofollow">Hexo</a>&nbsp;·&nbsp;
            Theme
            <a class="tomotoeslink" href="https://github.com/tomotoes/hexo-theme-tomotoes/" target="_blank" rel="external nofollow">tomotoes</a>
        </span>

        <br/>

        <span id="RunTime" style="color:#a7a7a2;"></span>
        <br/>

        <span>
            
	<i class="icon icon-lg icon-user">
<span id="busuanzi_container_site_uv" style='display:none'>
       访问用户：<span id="busuanzi_value_site_uv"></span>
    </span>人</i>
    ·
    <i class="icon icon-lg icon-eye">
    <span id="busuanzi_container_site_pv" style='display:none'>
      访问次数：<span id="busuanzi_value_site_pv"></span>
    </span>次
    </i>


        </span>
        <br/>

        <span class="license">This blog is licensed under a <a rel="license" rel="external nofollow" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</span>
    </div>
</footer>

    </main>
    
        

    
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://leng521.top/posts/79065537/&title=《scons自动构建工具》 — 小魏的博客&pic=https://leng521.top/img/head.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://leng521.top/posts/79065537/&title=《scons自动构建工具》 — 小魏的博客&source=这篇文章可能有点长,如果你想要学到一些知识,而不是简单入门,你要有耐心的看下去,当然在看的时候,也要自己思考,也许我写的有问题,这个时候你可以再去看看,官..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://leng521.top/posts/79065537/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《scons自动构建工具》 — 小魏的博客&url=https://leng521.top/posts/79065537/&via=https://leng521.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://leng521.top/posts/79065537/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p class="wechatshare">扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAK4AAACuCAAAAACKZ2kyAAABvklEQVR42u3aS2rEMBAFwLn/pZ3tQIj8uvWxCaXVYIxcmsWj1dLnE4/ra3w/Gb+TPP/sGLi4uNPcazhyyniG38S/5h/PgIuLe5L7V2IkoTOOuSr9xoaLi/tKbjWMkgXg4uL+D27+sVcEGS4ubotbjaG8tVHdXC3bq+Hi4k5w8y7lvt9b+ru4uLgt7lUc+San1xi9+TouLu4R7qoyJUfPlEe4uLhnuNUDkvkl9Q5co/8VFxd3KTdvmI5jKFleHnY3FRkuLu42bnLsMb+YcZA1L3/g4uIe5FYbpr2SKCpoxnPi4uJu5uaBUi1legsrFDe4uLjbuGNWfhxSbZoszl1cXNyl3FXHor33yxswXFzcI9xqPCUHqMm2Z0Hu4uLibuPOtznmD1kXtEpxcXE3c5O4qcZZjr6ZExcX9yHuzKaoCk2e4+LiPsXtFTQzJVE+c/2kBRcXt8+9imOGXj1EwcXFfYpbDZdxuVMNprWXvXBxcddy85bH2tKndyEDFxf3JLcaNDPXs3oLxsXFfTM3D6beRa5m1wQXF/fF3N7BakGIi4t7kLvqakW+cUpKKFxc3Ke41ShJ6DNVSv4tXFzcDdwfowTDQmG5BvsAAAAASUVORK5CYII=" alt="微信分享二维码">
</div>




    <!-- waves按钮特效 -->
<script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>

<!-- 主题配置脚本 -->
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };
</script>

<!-- jquery -->
<script src="/js/jquery.min.js?v=3.0"></script>

<!-- 搜索 -->

<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item waves-block waves-effect" onclick="location.href='{path}'">
    <div class="title ellipsis" title="{title}">{title}</div>
</li>
</template>


<!-- main博客脚本 -->
<script src="/js/main.min.js?v=3.0" ></script>

<!-- 动画&配置 -->
<script src="/js/script.min.js?v=3.0" ></script>

<!-- 脚本管理 -->
<script>

if(window.innerWidth > 800){
	/* 3D标题 */
	$(".content-header").on("mousemove", threedee);

	/* 底部追随鼠标 */
	$(".footer").hover(2);

	/* gotop键的涟漪 */
	$("#gotop").hover(1);

	/* 赞赏的粒子雨 */
	$("#reward").hover(3);

	/* 微信公众号的底部渲染 */
	$("#wechat").hover(4);

    /* 标题跳动 */
    $(".archivestitle").bumpyText();

	/* 图片点击放大 */
	const postimg = jQuery(".post-content img:not(.github-emoji)");
	postimg.on("click",function(){

		mask.classList.add("in");
		main.classList.add("Mask");
		menu.classList.add("Mask");
		var myimg = this.cloneNode(true);
		myimg.classList.add("imgShow");

		setTimeout(function(){
			jQuery(myimg).animate({
				opacity:"1"
			},1000);
		},0);

		document.body.appendChild(myimg);

		myimg.onclick=function(){
			document.body.removeChild(myimg);
			mask.classList.remove("in");
			main.classList.remove("Mask");
			menu.classList.remove("Mask");
		};

	});

}

/* 名字跳动 */
$("#name").bumpyText();


/* 网站运行时间 */
setInterval(function () {
	setTime("2018/01/17");
}, 1000);

/* 文章块的淡出 */
postshow();

/* 座右铭 */

    elasticText({
        id: "mymotto",
        duration: 100,
        effact: "easeOut",
        content: ""
    });



/* 粘贴提示 */
G($(".post-content"), location.href, "小魏");


/* 控制台 */
if (window.console && window.console.log) {
	setTimeout(function () {
		console.log("\n %c 一个坏掉的番茄 %c  © Simon Ma  http://tomotoes.com \n\n", "color:#FFFFFB;background:#1abc9c;padding:5px 0;border-radius:.5rem 0 0 .5rem;", "color:#FFFFFB;background:#080808;padding:5px 0;border-radius:0 .5rem .5rem 0;");
	}, 0);
}

</script>




<!-- 公式渲染 -->

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" async></script>



<!-- 不蒜子 -->

<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script>


</body>
</html>
