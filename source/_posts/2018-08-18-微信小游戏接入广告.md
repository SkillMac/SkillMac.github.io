---
title: 微信小游戏接入广告
comments: true
brief: 接入广告
layout: post
categories:
  - 微信小游戏
tags:
  - 微信小游戏
  - 广告
abbrlink: 967bbd27
date: 2018-08-18 22:34:25
permalink:
---
今天主要更新微信小游戏广告接入问题... 微信小游戏现在已经开始对外测试了,只要你的 UV(累计用户超过1000) 且没有违规行为,就可以填写个人信息,如,个人银行卡相关信息等,然后提交审核.如果接过广告的程序员,应该都知道在接入广告的时候需要先创建广告位,产生相关id.
<!-- more -->
大致流程

满足条件 --> 填写个人信息 --> 提交申请 --> 在微信后台创建广告位 --> 游戏前端添加
相应的代码逻辑

## **填写个人信息**
主要需要填写银行相关信息,账单流水邮件接收人的相关信息,,,这里我截图了,放在公司了,后面补上.

## **创建爱你广告位**

{% asset_img 1.png 广告位截图 %}

这里主要是广告的类型,,,目前下游戏提供的广告类型,,,只有横幅广告 和 激励广告

横幅广告:
    1.一般放在游戏的下方和游戏弹窗触发的情境下
    2.横幅广告组件一旦被创建里面的广告内容不会被更新,如果需要更新内容需要,需要将当前组件销毁,重新创建新的组件
    3.需要自己去放置位置,这里需要自己去计算位置和缩放和适配,计算不好会遮挡按钮,这个会违反微信小游戏广告规范,这样会有封号,或者是账号被冻结的问题.

激励广告:
    1.这个一般是全屏,不需要自己去考虑组件的位置等等
    2.主要运用的场景是游戏复活,获取积分,获取道具,获取新关卡机会等等
    3.主要负责视频是否播放完毕

## **客户端逻辑实现**

``` js
// 展示横幅广告
showAD() {
        if(CC_WECHATGAME && wx && typeof(wx.createBannerAd) != undefined) {
            this.destroyAd()
            // 横幅广告接入
            let bannerAd = wx.createBannerAd({
                adUnitId: 'adunit-68c37174ce72ce6b',
                style: {
                    left: 0,
                    top: 0,
                    width: 350
                }
            })
            // 一般放置屏幕的中下方
            bannerAd.onResize(function(){
                bannerAd.style.left = screenWidth / 2 - bannerAd.style.realWidth / 2 + 0.1;
                bannerAd.style.top = screenHeight - bannerAd.style.realHeight + 0.1;
            })

            // 默认广告组件是关闭的
            bannerAd.show()
            this._lastBannerAd = bannerAd
        }  
    },

    // 销毁横幅广告
    destroyAd() {
        if(this._lastBannerAd) {
            this._lastBannerAd.destroy()
            this._lastBannerAd = null
        }
    },

    // 展示 激励广告
    // obj.success 广告展示完毕回调
    // obj.fail 广告展示中途被玩家给关闭会回调
    showViewAd(obj){
        if(CC_WECHATGAME && wx && typeof(wx.createRewardedVideoAd) != undefined) {
            let videoAd = wx.createRewardedVideoAd({
                adUnitId: 'adunit-4db163908fba72f2'
            })
            
            videoAd.load()
            .then(() => videoAd.show())
            .catch(err => {
                // console.log(err.errMsg)
                videoAd.load.then(() => videoAd.show())
            })

            videoAd.onClose(res => {
                if (res && res.isEnded || res === undefined) {
                    // 正常播放结束，可以下发游戏奖励
                    if(obj.success) {
                        obj.success(res)
                    }
                  }
                  else {
                      // 播放中途退出，不下发游戏奖励
                      if(obj.fail) {
                          obj.fail()
                      }
                  }
            })

            videoAd.onError(res =>{
                console.log('错误',res)
            })
        } else {
            T.showTips('微信版本过低,请升级使用')
        }
    },
```
客户端的代码比较的简单,代码里都有注释,这里就不做过多的解释了.


